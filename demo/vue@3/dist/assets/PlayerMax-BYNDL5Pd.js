import{_,d as f,c as u,o as d,F as $,r as C,J as B,t as m,K as P,f as p,n as E,L,a as n,C as g,M,b as l,N as I,e as c,v as w,m as S,P as k,O as N,Q as R,R as X,S as v}from"./index-DQ-XM1sd.js";const O=f({name:"PlayerLyrics",data(){return{getVBindObj:L,prevLyricIndex:0,isTouching:!1,lyricElements:[]}},computed:{...p("player",["audioEl"]),...P("player",["lyricItems"]),lyricMillisecond(){return this.lyricItems.map(e=>e.millisecond)}},watch:{lyricItems:{handler:function(e){e.length!==0&&(this.lyricElements=e.map(()=>null))},immediate:!0,deep:!0}},mounted(){E(()=>{this.audioEl.addEventListener("timeupdate",this.timeUpdateCb)})},unmounted(){this.audioEl.removeEventListener("timeupdate",this.timeUpdateCb)},methods:{timeUpdateCb(e){if(this.isTouching)return;let t=Math.floor(e.target.currentTime*1e3),s=this.lyricMillisecond.findIndex(r=>r>t*1.005),i=s>1?s-2:0;this.$refs&&this.$refs[this.lyricMillisecond[i]]&&this.$refs[this.lyricMillisecond[i]][0].scrollIntoView(),this.prevLyricIndex=i}}});function U(e,t,s,i,o,r){return d(),u("div",{class:"player_lyric",onTouchstart:t[0]||(t[0]=a=>e.isTouching=!0),onTouchend:t[1]||(t[1]=a=>e.isTouching=!1)},[(d(!0),u($,null,C(e.lyricItems,(a,h)=>(d(),u("p",B({ref_for:!0},e.getVBindObj("millisecond-"+a.millisecond),{key:a.millisecond,ref_for:!0,ref:y=>e.lyricElements[a.millisecond]=y,class:h===e.prevLyricIndex+1?"player_lyric_text player_lyric_text--active ":"player_lyric_text"}),m(a.text),17))),128))],32)}const V=_(O,[["render",U],["__scopeId","data-v-2488bb82"]]),x=f({name:"PlayerProgress",data(){return{secondToMin:M,currentTime:0,loadProgress:0,isTouching:!1,touchStartX:0,progressBarRect:null}},computed:{...p("player",["song","audioEl"]),currentProgress(){return Math.floor(100*this.currentTime/this.audioEl.duration)},progressBarStyle(){return"background-image:linear-gradient(to right, #2ca2f9 ".concat(this.currentProgress,"%, transparent ").concat(this.currentProgress,"%),linear-gradient(to right, #6c6b70 ").concat(this.loadProgress,"%, transparent ").concat(this.loadProgress,"%)")}},mounted(){E(()=>{this.audioEl.addEventListener("progress",this.progressCb),this.audioEl.addEventListener("timeupdate",this.timeUpdateCb)})},unmounted(){this.audioEl.removeEventListener("progress",this.progressCb),this.audioEl.removeEventListener("timeupdate",this.timeUpdateCb)},methods:{progressCb(){if(this.audioEl.readyState<2)return;let e=this.audioEl.buffered.length;this.loadProgress=Math.floor(100*this.audioEl.buffered.end(e-1)/this.audioEl.duration)},timeUpdateCb(e){this.isTouching||(this.currentTime=e.target.currentTime)},setCurTime(e){this.isTouching=!0,this.progressBarRect||(this.progressBarRect=this.$refs.progressBar.getBoundingClientRect());let t=e.touches[0].clientX;this.currentTime=this.calcCurTime(t,this.progressBarRect.left,0),this.touchStartX=t,window.addEventListener("touchmove",this.setCurTimeOnMove),window.addEventListener("touchend",this.touchEndCb)},setCurTimeOnMove(e){let t=e.touches[0].clientX;this.currentTime=this.calcCurTime(t,this.touchStartX,1),this.touchStartX=t},touchEndCb(){this.isTouching=!1,this.audioEl.currentTime=this.currentTime,window.removeEventListener("touchmove",this.setCurTimeOnMove),window.removeEventListener("touchend",this.touchEndCb)},calcCurTime(e,t,s){let o=(e-t)/this.progressBarRect.width,r;switch(s){case 0:r=this.audioEl.duration*o;break;case 1:r=this.currentTime+this.audioEl.duration*o;break}return r<0?r=0:r>this.audioEl.duration&&(r=this.audioEl.duration),r}}}),H={class:"player_progress__song_cur_time"},j={class:"player_progress__song_duration"};function q(e,t,s,i,o,r){return d(),u("div",{class:"player_progress",onTouchstart:t[0]||(t[0]=(...a)=>e.setCurTime&&e.setCurTime(...a))},[n("div",H,m(e.secondToMin(e.currentTime)),1),n("div",{class:"player_progress__progress_bar",ref:"progressBar",style:g(e.progressBarStyle)},[n("div",{class:"player_progress__progress_bar_pointer",style:g("left:".concat(e.currentProgress,"%;"))},null,4)],4),n("div",j,m(e.secondToMin(e.audioEl.duration)),1)],32)}const z=_(x,[["render",q],["__scopeId","data-v-61901117"]]),A=f({name:"PlayerMax",components:{PlayerLyrics:V,PlayerProgress:z,PlayButton:R,NextButton:N,PrevButton:k},computed:{...p("images",["logo__theme"]),...p("player",["audioEl","isPlaying","song","music"]),...P("player",["songName","singerName","singerImg"]),playerBgImg(){return"background-image:url(".concat(this.singerImg,"),linear-gradient(to right, rgb(48, 67, 82), rgb(215, 210, 204));")}},watch:{"music.hash":function(e){this.$router.replace({query:{musicHash:e}})}},beforeRouteEnter(e,t,s){let i=e.query.musicHash;if(i)return e.meta.fromPlayerMed?s():X({params:{hash:i}}).then(o=>{let r=o.data.data;r.filename=r.audio_name,v.commit("player/wantPlay",{music:r,musicList:[r]}),v.commit("player/wantPlay",{music:r,musicList:[r]}),s()})},mounted(){this.replaceProperty({paths:"player.isPlayerMedShow",data:!1})},unmounted(){this.replaceProperty({paths:"player.isPlayerMedShow",data:!0}),this.replaceProperty({paths:"player.isPlayerMedSmall",data:!1})},methods:{...S(["replaceProperty"])}}),D={key:0,class:"player"},F={class:"player__cont"},G={class:"player__song_name"},J=["src"],K={class:"player__buttons"};function Q(e,t,s,i,o,r){const a=l("PlayerLyrics"),h=l("PlayerProgress"),y=l("PrevButton"),b=l("PlayButton"),T=l("NextButton");return e.music?(d(),u("section",D,[n("div",{class:"player__mask",style:g(e.playerBgImg)},null,4),n("div",F,[n("h6",G,m(e.songName),1),n("img",{src:e.singerImg,class:w(e.isPlaying?"player__singer_img player__singer_img--active":"player__singer_img")},null,10,J),c(a,{class:"player__lyrics"}),c(h,{class:"player__progress"}),n("div",K,[c(y,{class:"player__btn_prev"}),c(b,{class:"player__btn_status"}),c(T,{class:"play__btn_next"})]),t[0]||(t[0]=n("button",{class:"player__download"},null,-1))])])):I("",!0)}const Y=_(A,[["render",Q],["__scopeId","data-v-74839825"]]);export{Y as default};
