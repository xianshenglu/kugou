import{d as T,r as p,i as n,u as M,w as R,K as $,n as H,o as I,c as P,F as j,e as q,Q as z,R as E,S as D,t as w,f as L,_ as k,b as i,T as V,H as x,U as F,j as b,A as O,V as A,W as K,X as Q,Y as W,Z as N,M as Y}from"./index-C2WVff5c.js";const Z=T({__name:"PlayerLyrics",setup(f){const r=M(),c=p(0),e=p(!1),a=p({}),t=n(()=>r.state.player.audioEl),_=n(()=>r.getters["player/lyricItems"]),d=n(()=>_.value.map(s=>s.millisecond));R(_,s=>{s.length!==0&&(a.value={})},{immediate:!0,deep:!0});const o=s=>{if(e.value)return;let m=Math.floor(s.target.currentTime*1e3),l=d.value.findIndex(h=>h>m*1.005),v=l>1?l-2:0;a.value[d.value[v]]&&a.value[d.value[v]].scrollIntoView(),v.value=v};return $(()=>{H(()=>{t.value.addEventListener("timeupdate",o)})}),I(()=>{t.value.removeEventListener("timeupdate",o)}),(s,m)=>(L(),P("div",{class:"player_lyric",onTouchstart:m[0]||(m[0]=l=>e.value=!0),onTouchend:m[1]||(m[1]=l=>e.value=!1)},[(L(!0),P(j,null,q(_.value,(l,v)=>(L(),P("p",z({ref_for:!0},E(D)("millisecond-"+l.millisecond),{key:l.millisecond,ref_for:!0,ref:h=>a.value[l.millisecond]=h,class:v===c.value+1?"player_lyric_text player_lyric_text--active ":"player_lyric_text"}),w(l.text),17))),128))],32))}}),G=k(Z,[["__scopeId","data-v-f21aafd7"]]),J={class:"player_progress__song_cur_time"},ee={class:"player_progress__song_duration"},te=T({__name:"PlayerProgress",setup(f){const r=M(),c=p(null),e=n(()=>r.state.player.audioEl),a=p(0),t=p(0),_=p(!1),d=p(0),o=p(null),s=n(()=>Math.floor(100*a.value/e.value.duration)),m=n(()=>"background-image:linear-gradient(to right, #2ca2f9 ".concat(s.value,"%, transparent ").concat(s.value,"%),linear-gradient(to right, #6c6b70 ").concat(t.value,"%, transparent ").concat(t.value,"%)")),l=()=>{if(e.value.readyState<2)return;const u=e.value.buffered.length;t.value=Math.floor(100*e.value.buffered.end(u-1)/e.value.duration)},v=u=>{_.value||(a.value=u.target.currentTime)},h=u=>{_.value=!0,o.value||(o.value=c.value.getBoundingClientRect());const y=u.touches[0].clientX;a.value=S(y,o.value.left,0),d.value=y,window.addEventListener("touchmove",B),window.addEventListener("touchend",C)},B=u=>{const y=u.touches[0].clientX;a.value=S(y,d.value,1),d.value=y},C=()=>{_.value=!1,e.value.currentTime=a.value,window.removeEventListener("touchmove",B),window.removeEventListener("touchend",C)},S=(u,y,U)=>{const X=(u-y)/o.value.width;let g;switch(U){case 0:g=e.value.duration*X;break;case 1:g=g.value+e.value.duration*X;break}return g<0?g=0:g>e.value.duration&&(g=e.value.duration),g};return $(()=>{H(()=>{e.value.addEventListener("progress",l),e.value.addEventListener("timeupdate",v)})}),I(()=>{e.value.removeEventListener("progress",l),e.value.removeEventListener("timeupdate",v)}),(u,y)=>(L(),P("div",{class:"player_progress",onTouchstart:h},[i("div",J,w(E(V)(a.value)),1),i("div",{class:"player_progress__progress_bar",ref_key:"progressBar",ref:c,style:x(m.value)},[i("div",{class:"player_progress__progress_bar_pointer",style:x("left:".concat(s.value,"%;"))},null,4)],4),i("div",ee,w(E(V)(e.value.duration)),1)],32))}}),ae=k(te,[["__scopeId","data-v-52f24f79"]]),re={key:0,class:"player"},se={class:"player__cont"},le={class:"player__song_name"},ne=["src"],oe={class:"player__buttons"},ue={beforeRouteEnter(f,r,c){let e=f.query.musicHash;if(e)return f.meta.fromPlayerMed?c():W({params:{hash:e}}).then(a=>{let t=a.data.data;t.filename=t.audio_name,N.commit("player/wantPlay",{music:t,musicList:[t]}),N.commit("player/wantPlay",{music:t,musicList:[t]}),c()})}},ie=T({...ue,__name:"PlayerMax",setup(f){const r=M(),c=Y(),e=n(()=>r.state.player.music),a=n(()=>r.state.player.isPlaying),t=n(()=>r.getters["player/singerImg"]),_=n(()=>r.getters["player/songName"]),d=n(()=>"background-image:url(".concat(t.value,"),linear-gradient(to right, rgb(48, 67, 82), rgb(215, 210, 204));"));return R(()=>e==null?void 0:e.hash,o=>{c.replace({query:{musicHash:o}})}),$(()=>{r.commit("replaceProperty",{paths:"player.isPlayerMedShow",data:!1})}),I(()=>{r.commit("replaceProperty",{paths:"player.isPlayerMedShow",data:!0}),r.commit("replaceProperty",{paths:"player.isPlayerMedSmall",data:!1})}),(o,s)=>e.value?(L(),P("section",re,[i("div",{class:"player__mask",style:x(d.value)},null,4),i("div",se,[i("h6",le,w(_.value),1),i("img",{src:t.value,class:O(a.value?"player__singer_img player__singer_img--active":"player__singer_img")},null,10,ne),b(G,{class:"player__lyrics"}),b(ae,{class:"player__progress"}),i("div",oe,[b(A,{class:"player__btn_prev"}),b(K,{class:"player__btn_status"}),b(Q,{class:"play__btn_next"})]),s[0]||(s[0]=i("button",{class:"player__download"},null,-1))])])):F("",!0)}}),de=k(ie,[["__scopeId","data-v-92153401"]]);export{de as default};
