import{h as B,M as D,N as q,d as N,p as Q,r as _,i,u as j,O as z,P as b,o as F,z as H,Q as $,c as m,j as L,b as r,J as v,a as U,R as I,S as J,C as O,t as h,K as P,F as G,e as W,f,_ as X}from"./index-M2YJPBKr.js";import{P as Y}from"./PubModuleTitle-9vWJ6R0Q.js";import{A as Z}from"./AppMusicList-Cd1cbdNJ.js";import{u as ee}from"./useLoading-RZwmirTf.js";const te=({params:o={}}={})=>B({...D,params:{format:"json",plat:0,count:30,...o}}),se=({params:o={}}={})=>B({...q,params:{format:"json",page:1,pagesize:20,showtype:1,...o}});function ae(o){return o.data}function re(o){return o.data.info}const oe={class:"search"},ce=["placeholder"],ne={class:"search__rec"},le={class:"search__type"},ie={class:"search__list"},ue=["onClick"],he={class:"search__res"},de={class:"search__count"},pe=N({__name:"Search",setup(o){const t=j(),E=H(),K=$(),{startLoading:y,stopLoading:w,setLoadingExcludeSearchForm:S}=ee(),d=Q("searchCont"),g=_("搜索"),T=_("最近热门"),x=_("歌手/歌名/拼音"),R=i(()=>t.state.search.searchRecArr),k=i(()=>t.state.search.searchRes),s=i({get(){return t.state.search.keyword},set(e){t.commit("replaceProperty",{paths:"search.keyword",data:e})}}),n=i({get(){return t.state.search.isSearchRecShow},set(e){t.commit("replaceProperty",{paths:"search.isSearchRecShow",data:e})}}),c=i({get(){return t.state.search.isSearchResShow},set(e){t.commit("replaceProperty",{paths:"search.isSearchResShow",data:e})}});M(),z(()=>{p(),b.$on("searchBtnClicked",C)}),F(()=>{window.removeEventListener("touchstart",p),window.removeEventListener("touchmove",p),b.$off("searchBtnClicked",C)});function M(){const e=E.query.keyword,a=typeof s.value=="string"&&s.value!=="";typeof e=="string"&&e!==""&&e!==s.value?(s.value=e,u()):a?(n.value=!1,c.value=!0):V()}function V(){if(R.value.length!==0){c.value=!1,n.value=!0;return}S(),y(),te().then(({data:e})=>{t.commit("replaceProperty",{paths:"search.searchRecArr",data:re(e)}),w(),c.value=!1,n.value=!0}).catch(e=>{alert(e)})}function u(){s.value!==""&&(K.replace({query:{keyword:s.value}}),S(),y(),se({params:{keyword:s.value}}).then(e=>{t.commit("replaceProperty",{paths:"search.searchRes",data:ae(e.data)}),n.value=!1,c.value=!0,w()}))}function p(){const e=document.getElementsByClassName("search__cont")[0];if(e){window.search__cont=e;//! bug with qq browser
const a=function(){e.scrollTop};window.addEventListener("touchstart",a),window.addEventListener("touchmove",a)}}function C(){d.value&&(d.value.scrollTop=0)}return(e,a)=>(f(),m("section",oe,[L(Y,{title:g.value,class:"search__title"},null,8,["title"]),r("div",{class:"search__cont",ref_key:"searchCont",ref:d},[r("form",{class:"search__form",onSubmit:a[1]||(a[1]=U(()=>{},["prevent"]))},[v(r("input",{type:"text",placeholder:x.value,class:"search__input","onUpdate:modelValue":a[0]||(a[0]=l=>s.value=l),onKeyup:J(u,["enter"])},null,40,ce),[[I,s.value,void 0,{trim:!0}]]),r("button",{class:O(c.value?"search__btn search__btn--active":"search__btn"),type:"button",onClick:u},h(g.value),3)],32),v(r("div",ne,[r("h6",le,h(T.value),1),r("ul",ie,[(f(!0),m(G,null,W(R.value,(l,A)=>(f(),m("li",{class:"search__item main_border_bottom",key:A,onClick:_e=>{s.value=l.keyword,u()}},h(l.keyword),9,ue))),128))])],512),[[P,n.value]]),v(r("div",he,[r("div",de,"共有"+h(k.value.info.length)+"条结果",1),L(Z,{"music-list":k.value.info,class:"search__res-list"},null,8,["music-list"])],512),[[P,c.value]])],512)]))}}),we=X(pe,[["__scopeId","data-v-3e813df0"]]);export{we as default};
