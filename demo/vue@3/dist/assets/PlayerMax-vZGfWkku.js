import{d as I,r as m,i as u,u as M,w as V,G as $,n as q,o as B,c as b,F as z,e as H,N as O,z as E,O as j,t as w,f as x,_ as k,l as D,b as _,P as N,E as T,x as F,j as P,y as Q,Q as G,R as A,S as J,T as K,U as R,I as W}from"./index-DyHrXAmZ.js";const Y=I({__name:"PlayerLyrics",setup(f){const r=M(),c=m(0),e=m(!1),t=m({}),o=u(()=>r.state.player.audioEl),i=u(()=>r.getters["player/lyricItems"]),a=u(()=>i.value.map(l=>l.millisecond));V(i,l=>{l.length!==0&&(t.value={})},{immediate:!0,deep:!0});const s=l=>{if(e.value)return;let p=Math.floor(l.target.currentTime*1e3),n=a.value.findIndex(L=>L>p*1.005),y=n>1?n-2:0;const h=a.value[y];t.value[h]&&t.value[h].scrollIntoView(),c.value=y};return $(()=>{q(()=>{o.value.addEventListener("timeupdate",s)})}),B(()=>{o.value.removeEventListener("timeupdate",s)}),(l,p)=>(x(),b("div",{class:"player_lyric","test-id":"player-max-lyrics",onTouchstart:p[0]||(p[0]=n=>e.value=!0),onTouchend:p[1]||(p[1]=n=>e.value=!1)},[(x(!0),b(z,null,H(i.value,(n,y)=>(x(),b("p",O({ref_for:!0},E(j)("millisecond-"+n.millisecond),{key:n.millisecond,ref_for:!0,ref:h=>t.value[n.millisecond]=h,class:y===c.value+1?"player_lyric_text player_lyric_text--active ":"player_lyric_text"}),w(n.text),17))),128))],32))}}),Z=k(Y,[["__scopeId","data-v-6866e833"]]),ee={class:"player_progress__song_cur_time"},te={class:"player_progress__song_duration"},ae=I({__name:"PlayerProgress",setup(f){const r=M(),c=D("progressBar"),e=u(()=>r.state.player.audioEl),t=m(0),o=m(0),i=m(!1),a=m(0),s=m(null),l=u(()=>Math.floor(100*t.value/e.value.duration)),p=u(()=>"background-image:linear-gradient(to right, #2ca2f9 ".concat(l.value,"%, transparent ").concat(l.value,"%),linear-gradient(to right, #6c6b70 ").concat(o.value,"%, transparent ").concat(o.value,"%)")),n=()=>{if(e.value.readyState<2)return;const d=e.value.buffered.length;o.value=Math.floor(100*e.value.buffered.end(d-1)/e.value.duration)},y=d=>{i.value||(t.value=d.target.currentTime)},h=d=>{i.value=!0,s.value||(s.value=c.value.getBoundingClientRect());const v=d.touches[0].clientX;t.value=S(v,s.value.left,0),a.value=v,window.addEventListener("touchmove",L),window.addEventListener("touchend",C)},L=d=>{const v=d.touches[0].clientX;t.value=S(v,a.value,1),a.value=v},C=()=>{i.value=!1,e.value.currentTime=t.value,window.removeEventListener("touchmove",L),window.removeEventListener("touchend",C)},S=(d,v,U)=>{const X=(d-v)/s.value.width;let g;switch(U){case 0:g=e.value.duration*X;break;case 1:g=t.value+e.value.duration*X;break}return g<0?g=0:g>e.value.duration&&(g=e.value.duration),g};return $(()=>{q(()=>{e.value.addEventListener("progress",n),e.value.addEventListener("timeupdate",y)})}),B(()=>{e.value.removeEventListener("progress",n),e.value.removeEventListener("timeupdate",y)}),(d,v)=>(x(),b("div",{class:"player_progress","test-id":"player-max-progress",onTouchstart:h},[_("div",ee,w(E(N)(t.value)),1),_("div",{class:"player_progress__progress_bar",ref_key:"progressBar",ref:c,style:T(p.value)},[_("div",{class:"player_progress__progress_bar_pointer",style:T("left:".concat(l.value,"%;"))},null,4)],4),_("div",te,w(E(N)(e.value.duration)),1)],32))}}),re=k(ae,[["__scopeId","data-v-2e49df67"]]),se={key:0,class:"player","test-id":"player-max"},le={class:"player__cont"},ne={class:"player__song_name","test-id":"player-max-song-name"},oe=["src"],ie={class:"player__buttons"},ue={beforeRouteEnter(f,r,c){let e=f.query.musicHash;if(!e)return;const{fromPlayerMed:t,...o}=f.query;return t?c({...f,query:o}):K({params:{hash:e}}).then(i=>{let a=i.data.data;a.filename=a.audio_name,R.commit("player/wantPlay",{music:a,musicList:[a]}),R.commit("player/wantPlay",{music:a,musicList:[a]}),c()})}},ce=I({...ue,__name:"PlayerMax",setup(f){const r=M(),c=W(),e=u(()=>r.state.player.music),t=u(()=>r.state.player.isPlaying),o=u(()=>r.getters["player/singerImg"]),i=u(()=>r.getters["player/songName"]),a=u(()=>"background-image:url(".concat(o.value,"),linear-gradient(to right, rgb(48, 67, 82), rgb(215, 210, 204));"));return V(()=>{var s;return(s=e.value)==null?void 0:s.hash},s=>{c.replace({query:{musicHash:s}})}),$(()=>{r.commit("replaceProperty",{paths:"player.isPlayerMedShow",data:!1})}),B(()=>{r.commit("replaceProperty",{paths:"player.isPlayerMedShow",data:!0}),r.commit("replaceProperty",{paths:"player.isPlayerMedSmall",data:!1})}),(s,l)=>e.value?(x(),b("section",se,[_("div",{class:"player__mask",style:T(a.value)},null,4),_("div",le,[_("h6",ne,w(i.value),1),_("img",{src:o.value,class:Q(t.value?"player__singer_img player__singer_img--active":"player__singer_img")},null,10,oe),P(Z,{class:"player__lyrics"}),P(re,{class:"player__progress"}),_("div",ie,[P(G,{class:"player__btn_prev"}),P(A,{class:"player__btn_status"}),P(J,{class:"play__btn_next"})]),l[0]||(l[0]=_("button",{class:"player__download"},null,-1))])])):F("",!0)}}),pe=k(ce,[["__scopeId","data-v-f54ee02e"]]);export{pe as default};
