import{h as p,D as y,E as _,_ as f,d as R,b as c,c as o,o as h,e as n,a as t,A as i,w as g,G as k,H as v,v as C,t as a,B as l,F as $,r as b,m as L,f as T,I as d}from"./index-DQ-XM1sd.js";import{P}from"./PubModuleTitle-bhJPJVQ_.js";import{A}from"./AppMusicList-CyT_TbED.js";import{l as B}from"./loading-BIJBkQMi.js";const M=({params:e={}}={})=>p({..._,params:{format:"json",plat:0,count:30,...e}}),E=({params:e={}}={})=>p({...y,params:{format:"json",page:1,pagesize:20,showtype:1,...e}}),K=R({name:"Search",mixins:[B],components:{PubModuleTitle:P,AppMusicList:A},data(){return{title:"搜索",searchType:"最近热门",placeholder:"歌手/歌名/拼音"}},computed:{...T("search",["searchRecArr","searchRes","isSearchRecShow","isSearchResShow"]),keyword:{get(){return this.$store.state.search.keyword},set(e){this.replaceProperty({paths:"search.keyword",data:e})}},isSearchRecShow:{get(){return this.$store.state.search.isSearchRecShow},set(e){this.replaceProperty({paths:"search.isSearchRecShow",data:e})}},isSearchResShow:{get(){return this.$store.state.search.isSearchResShow},set(e){this.replaceProperty({paths:"search.isSearchResShow",data:e})}}},created(){this.init()},mounted(){d.$on("searchBtnClicked",this.scrollTopSearchCont),this.initQqBugDetect()},unmounted(){d.$off("searchBtnClicked",this.scrollTopSearchCont)},methods:{...L(["replaceProperty"]),init(){let e=this.$route.query.keyword,s=typeof this.keyword=="string"&&this.keyword!=="";typeof e=="string"&&e!==""&&e!==this.keyword?(this.keyword=e,this.getSearchRes()):s?(this.isSearchRecShow=!1,this.isSearchResShow=!0):this.getSearchRec()},getSearchRec(){if(this.searchRecArr.length!==0){this.isSearchResShow=!1,this.isSearchRecShow=!0;return}this.setLoadingExcludeSearchForm(),this.startLoading(),M().then(({data:e})=>{this.replaceProperty({paths:"search.searchRecArr",data:e.data.info}),this.stopLoading(),this.isSearchResShow=!1,this.isSearchRecShow=!0}).catch(e=>{alert(e)})},getSearchRes(){this.keyword!==""&&(this.$router.replace({query:{keyword:this.keyword}}),this.setLoadingExcludeSearchForm(),this.startLoading(),E({params:{keyword:this.keyword}}).then(e=>{let s=e.data.data;this.replaceProperty({paths:"search.searchRes",data:s}),this.isSearchRecShow=!1,this.isSearchResShow=!0,this.stopLoading()}))},initQqBugDetect(){let e=document.getElementsByClassName("search__cont")[0];window.search__cont=e;//! bug with qq browser
let s=function(){e.scrollTop};window.addEventListener("touchstart",s),window.addEventListener("touchmove",s)},scrollTopSearchCont(){this.$refs.searchCont&&(this.$refs.searchCont.scrollTop=0)}}}),V={class:"search"},q={class:"search__cont",ref:"searchCont"},D=["placeholder"],F={class:"search__rec"},Q={class:"search__type"},H={class:"search__list"},N=["onClick"],j={class:"search__res"},z={class:"search__count"};function I(e,s,u,G,U,J){const S=c("PubModuleTitle"),w=c("AppMusicList");return h(),o("section",V,[n(S,{title:e.title,class:"search__title"},null,8,["title"]),t("div",q,[t("form",{class:"search__form",onSubmit:s[3]||(s[3]=g(()=>{},["prevent"]))},[i(t("input",{type:"text",placeholder:e.placeholder,class:"search__input","onUpdate:modelValue":s[0]||(s[0]=r=>e.keyword=r),onKeyup:s[1]||(s[1]=v((...r)=>e.getSearchRes&&e.getSearchRes(...r),["enter"]))},null,40,D),[[k,e.keyword,void 0,{trim:!0}]]),t("button",{class:C(e.isSearchResShow?"search__btn search__btn--active":"search__btn"),type:"button",onClick:s[2]||(s[2]=(...r)=>e.getSearchRes&&e.getSearchRes(...r))},a(e.title),3)],32),i(t("div",F,[t("h6",Q,a(e.searchType),1),t("ul",H,[(h(!0),o($,null,b(e.searchRecArr,(r,m)=>(h(),o("li",{class:"search__item main_border_bottom",key:m,onClick:O=>{e.keyword=r.keyword,e.getSearchRes()}},a(r.keyword),9,N))),128))])],512),[[l,e.isSearchRecShow]]),i(t("div",j,[t("div",z,"共有"+a(e.searchRes.info.length)+"条结果",1),n(w,{"music-list":e.searchRes.info,class:"search__res-list"},null,8,["music-list"])],512),[[l,e.isSearchResShow]])],512)])}const x=f(K,[["render",I],["__scopeId","data-v-c47f9424"]]);export{x as default};
