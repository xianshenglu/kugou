import{d as I,r as m,i,u as M,w as V,G as $,n as q,o as B,c as b,F as z,e as H,N as O,z as E,O as j,t as w,f as x,_ as k,l as D,b as _,P as N,E as T,x as F,j as P,y as Q,Q as G,R as A,S as J,T as K,U as R,I as W}from"./index-AO6twGjP.js";const Y=I({__name:"PlayerLyrics",setup(f){const r=M(),u=m(0),e=m(!1),t=m({}),n=i(()=>r.state.player.audioEl),o=i(()=>r.getters["player/lyricItems"]),a=i(()=>o.value.map(s=>s.millisecond));V(o,s=>{s.length!==0&&(t.value={})},{immediate:!0,deep:!0});const c=s=>{if(e.value)return;let p=Math.floor(s.target.currentTime*1e3),l=a.value.findIndex(L=>L>p*1.005),y=l>1?l-2:0;const h=a.value[y];t.value[h]&&t.value[h].scrollIntoView(),u.value=y};return $(()=>{q(()=>{n.value.addEventListener("timeupdate",c)})}),B(()=>{n.value.removeEventListener("timeupdate",c)}),(s,p)=>(x(),b("div",{class:"player_lyric","test-id":"player-max-lyrics",onTouchstart:p[0]||(p[0]=l=>e.value=!0),onTouchend:p[1]||(p[1]=l=>e.value=!1)},[(x(!0),b(z,null,H(o.value,(l,y)=>(x(),b("p",O({ref_for:!0},E(j)("millisecond-"+l.millisecond),{key:l.millisecond,ref_for:!0,ref:h=>t.value[l.millisecond]=h,class:y===u.value+1?"player_lyric_text player_lyric_text--active ":"player_lyric_text"}),w(l.text),17))),128))],32))}}),Z=k(Y,[["__scopeId","data-v-6866e833"]]),ee={class:"player_progress__song_cur_time"},te={class:"player_progress__song_duration"},ae=I({__name:"PlayerProgress",setup(f){const r=M(),u=D("progressBar"),e=i(()=>r.state.player.audioEl),t=m(0),n=m(0),o=m(!1),a=m(0),c=m(null),s=i(()=>Math.floor(100*t.value/e.value.duration)),p=i(()=>`background-image:linear-gradient(to right, #2ca2f9 ${s.value}%, transparent ${s.value}%),linear-gradient(to right, #6c6b70 ${n.value}%, transparent ${n.value}%)`),l=()=>{if(e.value.readyState<2)return;const d=e.value.buffered.length;n.value=Math.floor(100*e.value.buffered.end(d-1)/e.value.duration)},y=d=>{o.value||(t.value=d.target.currentTime)},h=d=>{o.value=!0,c.value||(c.value=u.value.getBoundingClientRect());const v=d.touches[0].clientX;t.value=S(v,c.value.left,0),a.value=v,window.addEventListener("touchmove",L),window.addEventListener("touchend",C)},L=d=>{const v=d.touches[0].clientX;t.value=S(v,a.value,1),a.value=v},C=()=>{o.value=!1,e.value.currentTime=t.value,window.removeEventListener("touchmove",L),window.removeEventListener("touchend",C)},S=(d,v,U)=>{const X=(d-v)/c.value.width;let g;switch(U){case 0:g=e.value.duration*X;break;case 1:g=t.value+e.value.duration*X;break}return g<0?g=0:g>e.value.duration&&(g=e.value.duration),g};return $(()=>{q(()=>{e.value.addEventListener("progress",l),e.value.addEventListener("timeupdate",y)})}),B(()=>{e.value.removeEventListener("progress",l),e.value.removeEventListener("timeupdate",y)}),(d,v)=>(x(),b("div",{class:"player_progress","test-id":"player-max-progress",onTouchstart:h},[_("div",ee,w(E(N)(t.value)),1),_("div",{class:"player_progress__progress_bar",ref_key:"progressBar",ref:u,style:T(p.value)},[_("div",{class:"player_progress__progress_bar_pointer",style:T(`left:${s.value}%;`)},null,4)],4),_("div",te,w(E(N)(e.value.duration)),1)],32))}}),re=k(ae,[["__scopeId","data-v-2e49df67"]]),se={key:0,class:"player","test-id":"player-max"},le={class:"player__cont"},ne={class:"player__song_name","test-id":"player-max-song-name"},oe=["src"],ie={class:"player__buttons"},ue={beforeRouteEnter(f,r,u){let e=f.query.musicHash;if(!e)return;const{fromPlayerMed:t,...n}=f.query;return t?u({...f,query:n}):K({params:{hash:e}}).then(o=>{let a=o.data.data;a.filename=a.audio_name,R.commit("player/wantPlay",{music:a,musicList:[a]}),R.commit("player/wantPlay",{music:a,musicList:[a]}),u()})}},ce=I({...ue,__name:"PlayerMax",setup(f){const r=M(),u=W(),e=i(()=>r.state.player.music),t=i(()=>r.state.player.isPlaying),n=i(()=>r.getters["player/singerImg"]),o=i(()=>r.getters["player/songName"]),a=i(()=>`background-image:url(${n.value}),linear-gradient(to right, rgb(48, 67, 82), rgb(215, 210, 204));`);return V(()=>e.value?.hash,c=>{u.replace({query:{musicHash:c}})}),$(()=>{r.commit("replaceProperty",{paths:"player.isPlayerMedShow",data:!1})}),B(()=>{r.commit("replaceProperty",{paths:"player.isPlayerMedShow",data:!0}),r.commit("replaceProperty",{paths:"player.isPlayerMedSmall",data:!1})}),(c,s)=>e.value?(x(),b("section",se,[_("div",{class:"player__mask",style:T(a.value)},null,4),_("div",le,[_("h6",ne,w(o.value),1),_("img",{src:n.value,class:Q(t.value?"player__singer_img player__singer_img--active":"player__singer_img")},null,10,oe),P(Z,{class:"player__lyrics"}),P(re,{class:"player__progress"}),_("div",ie,[P(G,{class:"player__btn_prev"}),P(A,{class:"player__btn_status"}),P(J,{class:"play__btn_next"})]),s[0]||(s[0]=_("button",{class:"player__download"},null,-1))])])):F("",!0)}}),pe=k(ce,[["__scopeId","data-v-f54ee02e"]]);export{pe as default};
