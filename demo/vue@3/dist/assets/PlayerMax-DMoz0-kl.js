import{d as $,r as m,i as c,u as M,w as R,O as B,n as q,o as I,c as P,F as H,e as O,U as j,G as x,V as z,t as E,f as L,_ as C,p as D,b as d,W as V,L as T,B as F,j as b,C as Q,X as G,Y as W,Z as Y,$ as Z,a0 as N,Q as A}from"./index-M2YJPBKr.js";const J=$({__name:"PlayerLyrics",setup(f){const r=M(),i=m(0),e=m(!1),t=m({}),o=c(()=>r.state.player.audioEl),u=c(()=>r.getters["player/lyricItems"]),a=c(()=>u.value.map(l=>l.millisecond));R(u,l=>{l.length!==0&&(t.value={})},{immediate:!0,deep:!0});const s=l=>{if(e.value)return;let p=Math.floor(l.target.currentTime*1e3),n=a.value.findIndex(w=>w>p*1.005),y=n>1?n-2:0;const h=a.value[y];t.value[h]&&t.value[h].scrollIntoView(),i.value=y};return B(()=>{q(()=>{o.value.addEventListener("timeupdate",s)})}),I(()=>{o.value.removeEventListener("timeupdate",s)}),(l,p)=>(L(),P("div",{class:"player_lyric",onTouchstart:p[0]||(p[0]=n=>e.value=!0),onTouchend:p[1]||(p[1]=n=>e.value=!1)},[(L(!0),P(H,null,O(u.value,(n,y)=>(L(),P("p",j({ref_for:!0},x(z)("millisecond-"+n.millisecond),{key:n.millisecond,ref_for:!0,ref:h=>t.value[n.millisecond]=h,class:y===i.value+1?"player_lyric_text player_lyric_text--active ":"player_lyric_text"}),E(n.text),17))),128))],32))}}),K=C(J,[["__scopeId","data-v-0c47b8e4"]]),ee={class:"player_progress__song_cur_time"},te={class:"player_progress__song_duration"},ae=$({__name:"PlayerProgress",setup(f){const r=M(),i=D("progressBar"),e=c(()=>r.state.player.audioEl),t=m(0),o=m(0),u=m(!1),a=m(0),s=m(null),l=c(()=>Math.floor(100*t.value/e.value.duration)),p=c(()=>"background-image:linear-gradient(to right, #2ca2f9 ".concat(l.value,"%, transparent ").concat(l.value,"%),linear-gradient(to right, #6c6b70 ").concat(o.value,"%, transparent ").concat(o.value,"%)")),n=()=>{if(e.value.readyState<2)return;const _=e.value.buffered.length;o.value=Math.floor(100*e.value.buffered.end(_-1)/e.value.duration)},y=_=>{u.value||(t.value=_.target.currentTime)},h=_=>{u.value=!0,s.value||(s.value=i.value.getBoundingClientRect());const v=_.touches[0].clientX;t.value=S(v,s.value.left,0),a.value=v,window.addEventListener("touchmove",w),window.addEventListener("touchend",k)},w=_=>{const v=_.touches[0].clientX;t.value=S(v,a.value,1),a.value=v},k=()=>{u.value=!1,e.value.currentTime=t.value,window.removeEventListener("touchmove",w),window.removeEventListener("touchend",k)},S=(_,v,U)=>{const X=(_-v)/s.value.width;let g;switch(U){case 0:g=e.value.duration*X;break;case 1:g=t.value+e.value.duration*X;break}return g<0?g=0:g>e.value.duration&&(g=e.value.duration),g};return B(()=>{q(()=>{e.value.addEventListener("progress",n),e.value.addEventListener("timeupdate",y)})}),I(()=>{e.value.removeEventListener("progress",n),e.value.removeEventListener("timeupdate",y)}),(_,v)=>(L(),P("div",{class:"player_progress",onTouchstart:h},[d("div",ee,E(x(V)(t.value)),1),d("div",{class:"player_progress__progress_bar",ref_key:"progressBar",ref:i,style:T(p.value)},[d("div",{class:"player_progress__progress_bar_pointer",style:T("left:".concat(l.value,"%;"))},null,4)],4),d("div",te,E(x(V)(e.value.duration)),1)],32))}}),re=C(ae,[["__scopeId","data-v-e470aa3c"]]),se={key:0,class:"player"},le={class:"player__cont"},ne={class:"player__song_name"},oe=["src"],ue={class:"player__buttons"},ce={beforeRouteEnter(f,r,i){let e=f.query.musicHash;if(!e)return;const{fromPlayerMed:t,...o}=f.query;return t?i({...f,query:o}):Z({params:{hash:e}}).then(u=>{let a=u.data.data;a.filename=a.audio_name,N.commit("player/wantPlay",{music:a,musicList:[a]}),N.commit("player/wantPlay",{music:a,musicList:[a]}),i()})}},ie=$({...ce,__name:"PlayerMax",setup(f){const r=M(),i=A(),e=c(()=>r.state.player.music),t=c(()=>r.state.player.isPlaying),o=c(()=>r.getters["player/singerImg"]),u=c(()=>r.getters["player/songName"]),a=c(()=>"background-image:url(".concat(o.value,"),linear-gradient(to right, rgb(48, 67, 82), rgb(215, 210, 204));"));return R(()=>{var s;return(s=e.value)==null?void 0:s.hash},s=>{i.replace({query:{musicHash:s}})}),B(()=>{r.commit("replaceProperty",{paths:"player.isPlayerMedShow",data:!1})}),I(()=>{r.commit("replaceProperty",{paths:"player.isPlayerMedShow",data:!0}),r.commit("replaceProperty",{paths:"player.isPlayerMedSmall",data:!1})}),(s,l)=>e.value?(L(),P("section",se,[d("div",{class:"player__mask",style:T(a.value)},null,4),d("div",le,[d("h6",ne,E(u.value),1),d("img",{src:o.value,class:Q(t.value?"player__singer_img player__singer_img--active":"player__singer_img")},null,10,oe),b(K,{class:"player__lyrics"}),b(re,{class:"player__progress"}),d("div",ue,[b(G,{class:"player__btn_prev"}),b(W,{class:"player__btn_status"}),b(Y,{class:"play__btn_next"})]),l[0]||(l[0]=d("button",{class:"player__download"},null,-1))])])):F("",!0)}}),pe=C(ie,[["__scopeId","data-v-c790042b"]]);export{pe as default};
