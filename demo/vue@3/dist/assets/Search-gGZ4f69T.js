import{K as T,g as B,h as K,d as H,l as I,r as p,i,u as N,G as $,H as L,o as q,s as U,I as j,c as m,j as b,b as r,C as v,a as F,J as O,L as Q,y as z,t as h,D as E,F as J,e as W,f,_ as X}from"./index-AO6twGjP.js";import{P as Y}from"./PubModuleTitle-DNUD2Br9.js";import{A as Z}from"./AppMusicList-uGxwqFKe.js";import{u as ee}from"./useLoading-BrsUMYkL.js";const te={method:"GET",url:T+"/api/v3/search/hot"},se={method:"GET",url:T+"/api/v3/search/song"},ae=B(te,"hotSearch"),re=B(se,"keywordSearch"),oe=({params:o={}}={})=>K({...ae,params:{format:"json",plat:0,count:30,...o}}),ce=({params:o={}}={})=>K({...re,params:{format:"json",page:1,pagesize:20,showtype:1,...o}});function ne(o){return o.data}function le(o){return o.data.info}const ie={class:"search"},ue=["placeholder"],he={class:"search__rec"},de={class:"search__type"},_e={class:"search__list"},pe=["onClick"],me={class:"search__res"},ve={class:"search__count"},fe=H({__name:"Search",setup(o){const t=N(),D=U(),M=j(),{startLoading:y,stopLoading:w,setLoadingExcludeSearchForm:S}=ee(),d=I("searchCont"),g=p("搜索"),P=p("最近热门"),x=p("歌手/歌名/拼音"),R=i(()=>t.state.search.searchRecArr),k=i(()=>t.state.search.searchRes),s=i({get(){return t.state.search.keyword},set(e){t.commit("replaceProperty",{paths:"search.keyword",data:e})}}),n=i({get(){return t.state.search.isSearchRecShow},set(e){t.commit("replaceProperty",{paths:"search.isSearchRecShow",data:e})}}),c=i({get(){return t.state.search.isSearchResShow},set(e){t.commit("replaceProperty",{paths:"search.isSearchResShow",data:e})}});V(),$(()=>{_(),L.$on("searchBtnClicked",C)}),q(()=>{window.removeEventListener("touchstart",_),window.removeEventListener("touchmove",_),L.$off("searchBtnClicked",C)});function V(){const e=D.query.keyword,a=typeof s.value=="string"&&s.value!=="";typeof e=="string"&&e!==""&&e!==s.value?(s.value=e,u()):a?(n.value=!1,c.value=!0):A()}function A(){if(R.value.length!==0){c.value=!1,n.value=!0;return}S(),y(),oe().then(({data:e})=>{t.commit("replaceProperty",{paths:"search.searchRecArr",data:le(e)}),w(),c.value=!1,n.value=!0}).catch(e=>{alert(e)})}function u(){s.value!==""&&(M.replace({query:{keyword:s.value}}),S(),y(),ce({params:{keyword:s.value}}).then(e=>{t.commit("replaceProperty",{paths:"search.searchRes",data:ne(e.data)}),n.value=!1,c.value=!0,w()}))}function _(){const e=document.getElementsByClassName("search__cont")[0];if(e){window.search__cont=e;//! bug with qq browser
const a=function(){e.scrollTop};window.addEventListener("touchstart",a),window.addEventListener("touchmove",a)}}function C(){d.value&&(d.value.scrollTop=0)}return(e,a)=>(f(),m("section",ie,[b(Y,{title:g.value,class:"search__title"},null,8,["title"]),r("div",{class:"search__cont",ref_key:"searchCont",ref:d},[r("form",{class:"search__form",onSubmit:a[1]||(a[1]=F(()=>{},["prevent"]))},[v(r("input",{type:"text",placeholder:x.value,class:"search__input","onUpdate:modelValue":a[0]||(a[0]=l=>s.value=l),onKeyup:Q(u,["enter"])},null,40,ue),[[O,s.value,void 0,{trim:!0}]]),r("button",{class:z(c.value?"search__btn search__btn--active":"search__btn"),type:"button",onClick:u},h(g.value),3)],32),v(r("div",he,[r("h6",de,h(P.value),1),r("ul",_e,[(f(!0),m(J,null,W(R.value,(l,G)=>(f(),m("li",{class:"search__item main_border_bottom",key:G,onClick:ye=>{s.value=l.keyword,u()}},h(l.keyword),9,pe))),128))])],512),[[E,n.value]]),v(r("div",me,[r("div",ve,"共有"+h(k.value.info.length)+"条结果",1),b(Z,{"music-list":k.value.info,class:"search__res-list"},null,8,["music-list"])],512),[[E,c.value]])],512)]))}}),ke=X(fe,[["__scopeId","data-v-3e813df0"]]);export{ke as default};
