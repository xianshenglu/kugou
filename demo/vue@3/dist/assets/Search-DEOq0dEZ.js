import{h as B,I as q,J as N,d as j,r as h,i as l,u as z,K as D,L as C,o as F,z as Q,M as $,c as v,j as L,b as r,E as m,a as H,N as I,O as U,A as G,t as d,G as E,F as J,e as O,f,_ as W}from"./index-C2WVff5c.js";import{P as X}from"./PubModuleTitle-BSinRzLr.js";import{A as Y}from"./AppMusicList-TS7AMvcD.js";import{u as Z}from"./useLoading-B59CCrhl.js";const ee=({params:i={}}={})=>B({...q,params:{format:"json",plat:0,count:30,...i}}),te=({params:i={}}={})=>B({...N,params:{format:"json",page:1,pagesize:20,showtype:1,...i}}),se={class:"search"},ae=["placeholder"],re={class:"search__rec"},oe={class:"search__type"},ce={class:"search__list"},ne=["onClick"],le={class:"search__res"},ie={class:"search__count"},ue=j({__name:"Search",setup(i){const s=z(),K=Q(),P=$(),{startLoading:y,stopLoading:w,setLoadingExcludeSearchForm:S}=Z(),_=h(null),g=h("搜索"),x=h("最近热门"),A=h("歌手/歌名/拼音"),R=l(()=>s.state.search.searchRecArr),k=l(()=>s.state.search.searchRes),a=l({get(){return s.state.search.keyword},set(e){s.commit("replaceProperty",{paths:"search.keyword",data:e})}}),c=l({get(){return s.state.search.isSearchRecShow},set(e){s.commit("replaceProperty",{paths:"search.isSearchRecShow",data:e})}}),o=l({get(){return s.state.search.isSearchResShow},set(e){s.commit("replaceProperty",{paths:"search.isSearchResShow",data:e})}});M(),D(()=>{p(),C.$on("searchBtnClicked",b)}),F(()=>{window.removeEventListener("touchstart",p),window.removeEventListener("touchmove",p),C.$off("searchBtnClicked",b)});function M(){const e=K.query.keyword,t=typeof a.value=="string"&&a.value!=="";typeof e=="string"&&e!==""&&e!==a.value?(a.value=e,u()):t?(c.value=!1,o.value=!0):T()}function T(){if(R.value.length!==0){o.value=!1,c.value=!0;return}S(),y(),ee().then(({data:e})=>{s.commit("replaceProperty",{paths:"search.searchRecArr",data:e.data.info}),w(),o.value=!1,c.value=!0}).catch(e=>{alert(e)})}function u(){a.value!==""&&(P.replace({query:{keyword:a.value}}),S(),y(),te({params:{keyword:a.value}}).then(e=>{const t=e.data.data;s.commit("replaceProperty",{paths:"search.searchRes",data:t}),c.value=!1,o.value=!0,w()}))}function p(){const e=document.getElementsByClassName("search__cont")[0];if(e){window.search__cont=e;//! bug with qq browser
const t=function(){e.scrollTop};window.addEventListener("touchstart",t),window.addEventListener("touchmove",t)}}function b(){_.value&&(_.value.scrollTop=0)}return(e,t)=>(f(),v("section",se,[L(X,{title:g.value,class:"search__title"},null,8,["title"]),r("div",{class:"search__cont",ref_key:"searchCont",ref:_},[r("form",{class:"search__form",onSubmit:t[1]||(t[1]=H(()=>{},["prevent"]))},[m(r("input",{type:"text",placeholder:A.value,class:"search__input","onUpdate:modelValue":t[0]||(t[0]=n=>a.value=n),onKeyup:U(u,["enter"])},null,40,ae),[[I,a.value,void 0,{trim:!0}]]),r("button",{class:G(o.value?"search__btn search__btn--active":"search__btn"),type:"button",onClick:u},d(g.value),3)],32),m(r("div",re,[r("h6",oe,d(x.value),1),r("ul",ce,[(f(!0),v(J,null,O(R.value,(n,V)=>(f(),v("li",{class:"search__item main_border_bottom",key:V,onClick:he=>{a.value=n.keyword,u()}},d(n.keyword),9,ne))),128))])],512),[[E,c.value]]),m(r("div",le,[r("div",ie,"共有"+d(k.value.info.length)+"条结果",1),L(Y,{"music-list":k.value.info,class:"search__res-list"},null,8,["music-list"])],512),[[E,o.value]])],512)]))}}),me=W(ue,[["__scopeId","data-v-30d54373"]]);export{me as default};
