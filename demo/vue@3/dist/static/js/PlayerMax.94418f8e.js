"use strict";(self["webpackChunkkugou"]=self["webpackChunkkugou"]||[]).push([[522],{831:function(e,t,r){r.r(t),r.d(t,{default:function(){return x}});var s=r(6913);(0,s.Qi)("data-v-a53cc1da");const i={key:0,class:"player"},a={class:"player__cont"},n={class:"player__song_name"},o=["src"],l={class:"player__buttons"},c=(0,s.Lk)("button",{class:"player__download"},null,-1);function u(e,t,r,u,d,h){const m=(0,s.g2)("PlayerLyrics"),p=(0,s.g2)("PlayerProgress"),g=(0,s.g2)("PrevButton"),y=(0,s.g2)("PlayButton"),_=(0,s.g2)("NextButton");return e.music?((0,s.uX)(),(0,s.CE)("section",i,[(0,s.Lk)("div",{class:"player__mask",style:(0,s.Tr)(e.playerBgImg)},null,4),(0,s.Lk)("div",a,[(0,s.Lk)("h6",n,(0,s.v_)(e.songName),1),(0,s.Lk)("img",{src:e.singerImg,class:(0,s.C4)(e.isPlaying?"player__singer_img player__singer_img--active":"player__singer_img")},null,10,o),(0,s.bF)(m,{class:"player__lyrics"}),(0,s.bF)(p,{class:"player__progress"}),(0,s.Lk)("div",l,[(0,s.bF)(g,{class:"player__btn_prev"}),(0,s.bF)(y,{class:"player__btn_status"}),(0,s.bF)(_,{class:"play__btn_next"})]),c])])):(0,s.Q3)("",!0)}function d(e,t,r,i,a,n){return(0,s.uX)(),(0,s.CE)("div",{class:"player_lyric",onTouchstart:t[0]||(t[0]=t=>e.isTouching=!0),onTouchend:t[1]||(t[1]=t=>e.isTouching=!1)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.lyricItems,(t,r)=>((0,s.uX)(),(0,s.CE)("p",(0,s.v6)(e.getVBindObj("millisecond-"+t.millisecond),{key:t.millisecond,ref:r=>e.lyricElements[t.millisecond]=r,class:r===e.prevLyricIndex+1?"player_lyric_text player_lyric_text--active ":"player_lyric_text"}),(0,s.v_)(t.text),17))),128))],32)}(0,s.jt)();r(8111),r(1701);var h=r(6278),m=r(1981),p=(0,s.pM)({name:"PlayerLyrics",data(){return{getVBindObj:m.Zy,prevLyricIndex:0,isTouching:!1,lyricElements:[]}},computed:{...(0,h.aH)("player",["audioEl"]),...(0,h.L8)("player",["lyricItems"]),lyricMillisecond(){return this.lyricItems.map(e=>e.millisecond)}},watch:{lyricItems:{handler:function(e){0!==e.length&&(this.lyricElements=e.map(()=>null))},immediate:!0,deep:!0}},mounted(){(0,s.dY)(()=>{this.audioEl.addEventListener("timeupdate",this.timeUpdateCb)})},unmounted(){this.audioEl.removeEventListener("timeupdate",this.timeUpdateCb)},methods:{timeUpdateCb(e){if(this.isTouching)return;let t=Math.floor(1e3*e.target.currentTime),r=this.lyricMillisecond.findIndex(e=>e>1.005*t),s=r>1?r-2:0,i=this.$refs&&this.$refs[this.lyricMillisecond[s]];i&&this.$refs[this.lyricMillisecond[s]][0].scrollIntoView(),this.prevLyricIndex=s}}}),g=r(6262);const y=(0,g.A)(p,[["render",d],["__scopeId","data-v-184f50a4"]]);var _=y;(0,s.Qi)("data-v-b7d87cd8");const v={class:"player_progress__song_cur_time"},E={class:"player_progress__song_duration"};function b(e,t,r,i,a,n){return(0,s.uX)(),(0,s.CE)("div",{class:"player_progress",onTouchstart:t[0]||(t[0]=(...t)=>e.setCurTime&&e.setCurTime(...t))},[(0,s.Lk)("div",v,(0,s.v_)(e.secondToMin(e.currentTime)),1),(0,s.Lk)("div",{class:"player_progress__progress_bar",ref:"progressBar",style:(0,s.Tr)(e.progressBarStyle)},[(0,s.Lk)("div",{class:"player_progress__progress_bar_pointer",style:(0,s.Tr)(`left:${e.currentProgress}%;`)},null,4)],4),(0,s.Lk)("div",E,(0,s.v_)(e.secondToMin(e.audioEl.duration)),1)],32)}(0,s.jt)();var T=(0,s.pM)({name:"PlayerProgress",data(){return{secondToMin:m.Yn,currentTime:0,loadProgress:0,isTouching:!1,touchStartX:0,progressBarRect:null}},computed:{...(0,h.aH)("player",["song","audioEl"]),currentProgress(){return Math.floor(100*this.currentTime/this.audioEl.duration)},progressBarStyle(){return`background-image:linear-gradient(to right, #2ca2f9 ${this.currentProgress}%, transparent ${this.currentProgress}%),linear-gradient(to right, #6c6b70 ${this.loadProgress}%, transparent ${this.loadProgress}%)`}},mounted(){(0,s.dY)(()=>{this.audioEl.addEventListener("progress",this.progressCb),this.audioEl.addEventListener("timeupdate",this.timeUpdateCb)})},unmounted(){this.audioEl.removeEventListener("progress",this.progressCb),this.audioEl.removeEventListener("timeupdate",this.timeUpdateCb)},methods:{progressCb(){if(this.audioEl.readyState<2)return;let e=this.audioEl.buffered.length;this.loadProgress=Math.floor(100*this.audioEl.buffered.end(e-1)/this.audioEl.duration)},timeUpdateCb(e){this.isTouching||(this.currentTime=e.target.currentTime)},setCurTime(e){this.isTouching=!0,this.progressBarRect||(this.progressBarRect=this.$refs.progressBar.getBoundingClientRect());let t=e.touches[0].clientX;this.currentTime=this.calcCurTime(t,this.progressBarRect.left,0),this.touchStartX=t,window.addEventListener("touchmove",this.setCurTimeOnMove),window.addEventListener("touchend",this.touchEndCb)},setCurTimeOnMove(e){let t=e.touches[0].clientX;this.currentTime=this.calcCurTime(t,this.touchStartX,1),this.touchStartX=t},touchEndCb(){this.isTouching=!1,this.audioEl.currentTime=this.currentTime,window.removeEventListener("touchmove",this.setCurTimeOnMove),window.removeEventListener("touchend",this.touchEndCb)},calcCurTime(e,t,r){let s,i=e-t,a=i/this.progressBarRect.width;switch(r){case 0:s=this.audioEl.duration*a;break;case 1:s=this.currentTime+this.audioEl.duration*a;break}return s<0?s=0:s>this.audioEl.duration&&(s=this.audioEl.duration),s}}});const P=(0,g.A)(T,[["render",b],["__scopeId","data-v-b7d87cd8"]]);var f=P,C=r(7288),L=r(8350),k=r(8270),B=r(7757),M=r(6204),w=(0,s.pM)({name:"PlayerMax",components:{PlayerLyrics:_,PlayerProgress:f,PlayButton:C.A,NextButton:L.A,PrevButton:k.A},computed:{...(0,h.aH)("images",["logo__theme"]),...(0,h.aH)("player",["audioEl","isPlaying","song","music"]),...(0,h.L8)("player",["songName","singerName","singerImg"]),playerBgImg(){return`background-image:url(${this.singerImg}),linear-gradient(to right, rgb(48, 67, 82), rgb(215, 210, 204));`}},watch:{"music.hash":function(e){this.$router.replace({query:{musicHash:e}})}},beforeRouteEnter(e,t,r){let s=e.query.musicHash;if(s)return e.meta.fromPlayerMed?r():(0,B.B)({params:{hash:s}}).then(e=>{let t=e.data.data;t.filename=t.audio_name,M.A.commit("player/wantPlay",{music:t,musicList:[t]}),M.A.commit("player/wantPlay",{music:t,musicList:[t]}),r()})},mounted(){this.replaceProperty({paths:"player.isPlayerMedShow",data:!1})},unmounted(){this.replaceProperty({paths:"player.isPlayerMedShow",data:!0}),this.replaceProperty({paths:"player.isPlayerMedSmall",data:!1})},methods:{...(0,h.PY)(["replaceProperty"])}});const I=(0,g.A)(w,[["render",u],["__scopeId","data-v-a53cc1da"]]);var x=I}}]);
//# sourceMappingURL=PlayerMax.94418f8e.js.map