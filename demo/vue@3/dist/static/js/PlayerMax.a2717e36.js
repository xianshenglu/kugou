"use strict";(self["webpackChunkkugou"]=self["webpackChunkkugou"]||[]).push([[522],{6857:function(e,t,r){r.r(t),r.d(t,{default:function(){return X}});var s=r(641),i=r(2644);(0,s.Qi)("data-v-a53cc1da");const a={key:0,class:"player"},n={class:"player__cont"},o={class:"player__song_name"},l=["src"],c={class:"player__buttons"},u=(0,s.Lk)("button",{class:"player__download"},null,-1);function d(e,t,r,d,h,m){const p=(0,s.g2)("PlayerLyrics"),g=(0,s.g2)("PlayerProgress"),y=(0,s.g2)("PrevButton"),_=(0,s.g2)("PlayButton"),v=(0,s.g2)("NextButton");return e.music?((0,s.uX)(),(0,s.CE)("section",a,[(0,s.Lk)("div",{class:"player__mask",style:(0,i.Tr)(e.playerBgImg)},null,4),(0,s.Lk)("div",n,[(0,s.Lk)("h6",o,(0,i.v_)(e.songName),1),(0,s.Lk)("img",{src:e.singerImg,class:(0,i.C4)(e.isPlaying?"player__singer_img player__singer_img--active":"player__singer_img")},null,10,l),(0,s.bF)(p,{class:"player__lyrics"}),(0,s.bF)(g,{class:"player__progress"}),(0,s.Lk)("div",c,[(0,s.bF)(y,{class:"player__btn_prev"}),(0,s.bF)(_,{class:"player__btn_status"}),(0,s.bF)(v,{class:"play__btn_next"})]),u])])):(0,s.Q3)("",!0)}function h(e,t,r,a,n,o){return(0,s.uX)(),(0,s.CE)("div",{class:"player_lyric",onTouchstart:t[0]||(t[0]=t=>e.isTouching=!0),onTouchend:t[1]||(t[1]=t=>e.isTouching=!1)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.lyricItems,(t,r)=>((0,s.uX)(),(0,s.CE)("p",(0,s.v6)(e.getVBindObj("millisecond-"+t.millisecond),{key:t.millisecond,ref:r=>e.lyricElements[t.millisecond]=r,class:r===e.prevLyricIndex+1?"player_lyric_text player_lyric_text--active ":"player_lyric_text"}),(0,i.v_)(t.text),17))),128))],32)}(0,s.jt)();r(8111),r(1701);var m=r(6278),p=r(1981),g=(0,s.pM)({name:"PlayerLyrics",data(){return{getVBindObj:p.Zy,prevLyricIndex:0,isTouching:!1,lyricElements:[]}},computed:{...(0,m.aH)("player",["audioEl"]),...(0,m.L8)("player",["lyricItems"]),lyricMillisecond(){return this.lyricItems.map(e=>e.millisecond)}},watch:{lyricItems:{handler:function(e){0!==e.length&&(this.lyricElements=e.map(()=>null))},immediate:!0,deep:!0}},mounted(){(0,s.dY)(()=>{this.audioEl.addEventListener("timeupdate",this.timeUpdateCb)})},unmounted(){this.audioEl.removeEventListener("timeupdate",this.timeUpdateCb)},methods:{timeUpdateCb(e){if(this.isTouching)return;let t=Math.floor(1e3*e.target.currentTime),r=this.lyricMillisecond.findIndex(e=>e>1.005*t),s=r>1?r-2:0,i=this.$refs&&this.$refs[this.lyricMillisecond[s]];i&&this.$refs[this.lyricMillisecond[s]][0].scrollIntoView(),this.prevLyricIndex=s}}}),y=r(6262);const _=(0,y.A)(g,[["render",h],["__scopeId","data-v-184f50a4"]]);var v=_;(0,s.Qi)("data-v-b7d87cd8");const E={class:"player_progress__song_cur_time"},b={class:"player_progress__song_duration"};function T(e,t,r,a,n,o){return(0,s.uX)(),(0,s.CE)("div",{class:"player_progress",onTouchstart:t[0]||(t[0]=(...t)=>e.setCurTime&&e.setCurTime(...t))},[(0,s.Lk)("div",E,(0,i.v_)(e.secondToMin(e.currentTime)),1),(0,s.Lk)("div",{class:"player_progress__progress_bar",ref:"progressBar",style:(0,i.Tr)(e.progressBarStyle)},[(0,s.Lk)("div",{class:"player_progress__progress_bar_pointer",style:(0,i.Tr)(`left:${e.currentProgress}%;`)},null,4)],4),(0,s.Lk)("div",b,(0,i.v_)(e.secondToMin(e.audioEl.duration)),1)],32)}(0,s.jt)();var P=(0,s.pM)({name:"PlayerProgress",data(){return{secondToMin:p.Yn,currentTime:0,loadProgress:0,isTouching:!1,touchStartX:0,progressBarRect:null}},computed:{...(0,m.aH)("player",["song","audioEl"]),currentProgress(){return Math.floor(100*this.currentTime/this.audioEl.duration)},progressBarStyle(){return`background-image:linear-gradient(to right, #2ca2f9 ${this.currentProgress}%, transparent ${this.currentProgress}%),linear-gradient(to right, #6c6b70 ${this.loadProgress}%, transparent ${this.loadProgress}%)`}},mounted(){(0,s.dY)(()=>{this.audioEl.addEventListener("progress",this.progressCb),this.audioEl.addEventListener("timeupdate",this.timeUpdateCb)})},unmounted(){this.audioEl.removeEventListener("progress",this.progressCb),this.audioEl.removeEventListener("timeupdate",this.timeUpdateCb)},methods:{progressCb(){if(this.audioEl.readyState<2)return;let e=this.audioEl.buffered.length;this.loadProgress=Math.floor(100*this.audioEl.buffered.end(e-1)/this.audioEl.duration)},timeUpdateCb(e){this.isTouching||(this.currentTime=e.target.currentTime)},setCurTime(e){this.isTouching=!0,this.progressBarRect||(this.progressBarRect=this.$refs.progressBar.getBoundingClientRect());let t=e.touches[0].clientX;this.currentTime=this.calcCurTime(t,this.progressBarRect.left,0),this.touchStartX=t,window.addEventListener("touchmove",this.setCurTimeOnMove),window.addEventListener("touchend",this.touchEndCb)},setCurTimeOnMove(e){let t=e.touches[0].clientX;this.currentTime=this.calcCurTime(t,this.touchStartX,1),this.touchStartX=t},touchEndCb(){this.isTouching=!1,this.audioEl.currentTime=this.currentTime,window.removeEventListener("touchmove",this.setCurTimeOnMove),window.removeEventListener("touchend",this.touchEndCb)},calcCurTime(e,t,r){let s,i=e-t,a=i/this.progressBarRect.width;switch(r){case 0:s=this.audioEl.duration*a;break;case 1:s=this.currentTime+this.audioEl.duration*a;break}return s<0?s=0:s>this.audioEl.duration&&(s=this.audioEl.duration),s}}});const f=(0,y.A)(P,[["render",T],["__scopeId","data-v-b7d87cd8"]]);var C=f,L=r(7288),k=r(8350),B=r(8270),M=r(7757),w=r(6204),I=(0,s.pM)({name:"PlayerMax",components:{PlayerLyrics:v,PlayerProgress:C,PlayButton:L.A,NextButton:k.A,PrevButton:B.A},computed:{...(0,m.aH)("images",["logo__theme"]),...(0,m.aH)("player",["audioEl","isPlaying","song","music"]),...(0,m.L8)("player",["songName","singerName","singerImg"]),playerBgImg(){return`background-image:url(${this.singerImg}),linear-gradient(to right, rgb(48, 67, 82), rgb(215, 210, 204));`}},watch:{"music.hash":function(e){this.$router.replace({query:{musicHash:e}})}},beforeRouteEnter(e,t,r){let s=e.query.musicHash;if(s)return e.meta.fromPlayerMed?r():(0,M.B)({params:{hash:s}}).then(e=>{let t=e.data.data;t.filename=t.audio_name,w.A.commit("player/wantPlay",{music:t,musicList:[t]}),w.A.commit("player/wantPlay",{music:t,musicList:[t]}),r()})},mounted(){this.replaceProperty({paths:"player.isPlayerMedShow",data:!1})},unmounted(){this.replaceProperty({paths:"player.isPlayerMedShow",data:!0}),this.replaceProperty({paths:"player.isPlayerMedSmall",data:!1})},methods:{...(0,m.PY)(["replaceProperty"])}});const x=(0,y.A)(I,[["render",d],["__scopeId","data-v-a53cc1da"]]);var X=x}}]);
//# sourceMappingURL=PlayerMax.a2717e36.js.map