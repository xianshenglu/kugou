import{r as y,j as c,i as j,h as _,P as u,c as v,H as T,t as k,u as O,b as D,I as z}from"./index-C7fqB9nJ.js";import{P as W,a as X,N as F,w as A}from"./index-DMxX0uXZ.js";class I extends y.Component{constructor(e){super(e),this.lyricsRef=[]}componentDidUpdate(){const{prevLyricIndex:e}=this.props;this.lyricsRef[e]&&this.lyricsRef[e].current.scrollIntoView()}render(){this.lyricsRef=[];const{lyrics:e,prevLyricIndex:s,toggleIsTouching:r}=this.props;return c.jsx("div",{className:"PlayerLyric",onTouchStart:()=>r(!0),onTouchEnd:()=>r(!1),children:e.map((n,i)=>{const a=j.createRef();return this.lyricsRef.push(a),c.jsx("p",{ref:a,className:_("PlayerLyric_text",{"PlayerLyric_text--active":i===s+1}),children:n.text},i)})})}}I.propTypes={lyrics:u.arrayOf(u.shape({text:u.string.isRequired})).isRequired,prevLyricIndex:u.number.isRequired,toggleIsTouching:u.func.isRequired};function H(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function V(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function K(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(s=>typeof s=="function")){const s=t.map(r=>typeof r=="function"?`function ${r.name||"unnamed"}()`:typeof r).join(", ");throw new TypeError(`${e}[${s}]`)}}var E=t=>Array.isArray(t)?t:[t];function G(t){const e=Array.isArray(t[0])?t[0]:t;return K(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function J(t,e){const s=[],{length:r}=t;for(let n=0;n<r;n++)s.push(t[n].apply(null,e));return s}var Q=class{constructor(t){this.value=t}deref(){return this.value}},Y=typeof WeakRef<"u"?WeakRef:Q,Z=0,M=1;function x(){return{s:Z,v:void 0,o:null,p:null}}function N(t,e={}){let s=x();const{resultEqualityCheck:r}=e;let n,i=0;function a(){let o=s;const{length:d}=arguments;for(let m=0,R=d;m<R;m++){const f=arguments[m];if(typeof f=="function"||typeof f=="object"&&f!==null){let h=o.o;h===null&&(o.o=h=new WeakMap);const g=h.get(f);g===void 0?(o=x(),h.set(f,o)):o=g}else{let h=o.p;h===null&&(o.p=h=new Map);const g=h.get(f);g===void 0?(o=x(),h.set(f,o)):o=g}}const l=o;let p;if(o.s===M)p=o.v;else if(p=t.apply(null,arguments),i++,r){const m=n?.deref?.()??n;m!=null&&r(m,p)&&(p=m,i!==0&&i--),n=typeof p=="object"&&p!==null||typeof p=="function"?new Y(p):p}return l.s=M,l.v=p,p}return a.clearCache=()=>{s=x(),a.resetResultsCount()},a.resultsCount=()=>i,a.resetResultsCount=()=>{i=0},a}function ee(t,...e){const s=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,r=(...n)=>{let i=0,a=0,o,d={},l=n.pop();typeof l=="object"&&(d=l,l=n.pop()),H(l,`createSelector expects an output function after the inputs, but received: [${typeof l}]`);const p={...s,...d},{memoize:m,memoizeOptions:R=[],argsMemoize:f=N,argsMemoizeOptions:h=[]}=p,g=E(R),q=E(h),b=G(n),C=m(function(){return i++,l.apply(null,arguments)},...g),B=f(function(){a++;const U=J(b,arguments);return o=C.apply(null,U),o},...q);return Object.assign(B,{resultFunc:l,memoizedResultFunc:C,dependencies:b,dependencyRecomputations:()=>a,resetDependencyRecomputations:()=>{a=0},lastResult:()=>o,recomputations:()=>i,resetRecomputations:()=>{i=0},memoize:m,argsMemoize:f})};return Object.assign(r,{withTypes:()=>r}),r}var P=ee(N),te=Object.assign((t,e=P)=>{V(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const s=Object.keys(t),r=s.map(i=>t[i]);return e(r,(...i)=>i.reduce((a,o,d)=>(a[s[d]]=o,a),{}))},{withTypes:()=>te});const S=P([t=>t],t=>{let e=t.split(/\n/);return e.pop(),e.map(s=>{let r=s.replace("[","").split("]"),n=r[0],i=n.split(":")[0],a=n.split(":")[1].split(".")[0],o=n.split(":")[1].split(".")[1];return{millisecond:i*60*1e3+a*1e3+Number(o),text:r[1].trim().replace(/(男[:：]\s*)|(女[:：]\s*)/,"")}})}),se=P([t=>t],t=>t.map(e=>e.millisecond));class re extends y.Component{constructor(e){super(e),this.state={prevLyricIndex:0,isTouching:!1},this.timeUpdateCb=this.timeUpdateCb.bind(this),this.toggleIsTouching=this.toggleIsTouching.bind(this)}toggleIsTouching(e){this.setState({isTouching:e})}componentDidMount(){const{audioElRef:{current:e}}=this.props;e.addEventListener("timeupdate",this.timeUpdateCb)}componentWillUnmount(){const{audioElRef:{current:e}}=this.props;e.removeEventListener("timeupdate",this.timeUpdateCb)}timeUpdateCb(e){const{isTouching:s}=this.state;if(s)return;const{lyric:r}=this.props,n=S(r),i=se(n);let a=Math.floor(e.target.currentTime*1e3),o=i.findIndex(l=>l>a*1.005),d=o>1?o-2:0;this.setState({prevLyricIndex:d})}render(){const{lyric:e}=this.props,{prevLyricIndex:s}=this.state,n={lyrics:S(e),prevLyricIndex:s,toggleIsTouching:this.toggleIsTouching};return c.jsx(I,{...n})}}const ne=({player:{songInfo:{lyric:t},audioElRef:e}})=>({lyric:t,audioElRef:e}),oe=v(ne,null)(re);class w extends y.Component{render(){const{audioElRef:{current:e},progressBarRef:s,currentTime:r,currentProgress:n,loadProgress:i,onTouchStart:a}=this.props,o=e===null?{duration:0}:e,d={backgroundImage:`linear-gradient(to right, #2ca2f9 ${n}%, transparent ${n}%),linear-gradient(to right, #6c6b70 ${i}%, transparent ${i}%)`,color:"red"};return c.jsxs("div",{className:"PlayerProgress",onTouchStart:a,children:[c.jsx("div",{className:"PlayerProgress__songCurTime",children:T(r)}),c.jsx("div",{className:"PlayerProgress__progressBar",ref:s,style:d,children:c.jsx("div",{className:"PlayerProgress__progressBarPointer",style:{left:n+"%"}})}),c.jsx("div",{className:"PlayerProgress__songDuration",children:T(o.duration)})]})}}w.propTypes={audioElRef:u.object.isRequired,progressBarRef:u.object.isRequired,currentTime:u.number.isRequired,currentProgress:u.number.isRequired,loadProgress:u.number.isRequired,onTouchStart:u.func.isRequired};class ie extends y.Component{constructor(e){super(e),this.state={currentTime:0,loadProgress:0,currentProgress:0,isTouching:!1},this.progressBarRef=j.createRef(),this.progressCb=this.progressCb.bind(this),this.timeUpdateCb=this.timeUpdateCb.bind(this),this.setCurTime=this.setCurTime.bind(this),this.setCurTimeOnMove=this.setCurTimeOnMove.bind(this),this.touchEndCb=this.touchEndCb.bind(this)}progressCb(){const{audioElRef:{current:e}}=this.props;if(e.readyState<2)return;let s=e.buffered.length;const r=Math.floor(100*e.buffered.end(s-1)/e.duration);this.setState({loadProgress:r})}timeUpdateCb(e){if(this.state.isTouching)return;const{audioElRef:{current:{duration:s}}}=this.props,r=e.target.currentTime,n=Math.floor(100*r/s);this.setState({currentTime:r,currentProgress:n})}setCurTime(e){this.setState({isTouching:!0}),this.progressBarRect||(this.progressBarRect=this.progressBarRef.current.getBoundingClientRect());let s=e.touches[0].clientX;const r=this.calcCurTime(s,this.progressBarRect.left,0),{audioElRef:{current:{duration:n}}}=this.props,i=Math.floor(100*r/n);this.setState({currentTime:r,currentProgress:i}),this.touchStartX=s,window.addEventListener("touchmove",this.setCurTimeOnMove),window.addEventListener("touchend",this.touchEndCb)}setCurTimeOnMove(e){let s=e.touches[0].clientX;const r=this.calcCurTime(s,this.touchStartX,1),{audioElRef:{current:{duration:n}}}=this.props,i=Math.floor(100*r/n);this.setState({currentTime:r,currentProgress:i}),this.touchStartX=s}touchEndCb(){const{audioElRef:{current:e}}=this.props;this.setState({isTouching:!1}),e.currentTime=this.state.currentTime,window.removeEventListener("touchmove",this.setCurTimeOnMove),window.removeEventListener("touchend",this.touchEndCb)}calcCurTime(e,s,r){let i=(e-s)/this.progressBarRect.width,a;const{audioElRef:{current:{duration:o}}}=this.props;switch(r){case 0:a=o*i;break;case 1:a=this.state.currentTime+o*i;break}return a<0?a=0:a>o&&(a=o),a}componentDidMount(){const{audioElRef:{current:e}}=this.props;e.addEventListener("progress",this.progressCb),e.addEventListener("timeupdate",this.timeUpdateCb)}componentWillUnmount(){const{audioElRef:{current:e}}=this.props;e.removeEventListener("progress",this.progressCb),e.removeEventListener("timeupdate",this.timeUpdateCb)}render(){const{audioElRef:e}=this.props,s={audioElRef:e,...this.state,onTouchStart:this.setCurTime,progressBarRef:this.progressBarRef};return c.jsx(w,{...s})}}const ae=({player:{audioElRef:t}})=>({audioElRef:t}),ce=v(ae,null)(ie);class L extends y.Component{render(){const{songInfo:{song_name:e,author_name:s,img:r},musicStatus:{isPlaying:n,isLoading:i},dispatch:a,prevSong:o,nextSong:d}=this.props;return c.jsxs(y.Fragment,{children:[c.jsx("div",{className:"PlayerMax__mask",style:{backgroundImage:`url(${r}),linear-gradient(to right, rgb(48, 67, 82), rgb(215, 210, 204))`}}),c.jsxs("div",{className:"PlayerMax__container",children:[c.jsx("h6",{className:"PlayerMax__songName",children:e}),c.jsx("img",{src:r,className:_("PlayerMax__singerImg",{"PlayerMax__singerImg--active":n}),alt:s}),c.jsx(oe,{}),c.jsx(ce,{}),c.jsxs("div",{className:"PlayerMax__buttonContainer",children:[c.jsx(W,{className:"PlayerMax__prevBtn",prev:o}),c.jsx(X,{className:"PlayerMax__playBtn",isLoading:i,isPlaying:n,togglePlay:l=>a(k())}),c.jsx(F,{className:"PlayerMax__nextBtn",next:d})]}),c.jsx("button",{className:"PlayerMax__download"})]})]})}}L.propTypes={songInfo:u.shape({song_name:u.string.isRequired,author_name:u.string.isRequired,img:u.string.isRequired}).isRequired,musicStatus:u.shape({isPlaying:u.bool.isRequired,isLoading:u.bool.isRequired}).isRequired,dispatch:u.func.isRequired,nextSong:u.func.isRequired,prevSong:u.func.isRequired};class ue extends y.Component{componentDidMount(){const{dispatch:e,location:s,songInfo:{play_url:r}}=this.props;if(r===""){const n=new URLSearchParams(s.search).get("musicHash");e(z(n,0,[{hash:n}]))}}render(){const{songInfo:{play_url:e},dispatch:s,audioElRef:r}=this.props,n={...this.props};return c.jsx(L,{...n})}}const le=({player:{musicStatus:t,songInfo:e,audioElRef:s,songIndex:r,songList:n}})=>({musicStatus:t,songInfo:e,audioElRef:s,songIndex:r,songList:n}),pe=null,de=A(ue);function he(t){const e=O(),s=D();return c.jsx(de,{...t,location:e,navigate:s})}const ge=v(le,pe)(he);export{ge as default};
