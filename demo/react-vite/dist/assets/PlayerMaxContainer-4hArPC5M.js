import{r as g,j as c,h as j,g as _,c as v,G as b,t as B,u as $,b as U,H as k}from"./index-CaPGCRQz.js";import{P as O,a as D,N as z,w as W}from"./index-D2drJCgA.js";class X extends g.Component{constructor(e){super(e),this.lyricsRef=[]}componentDidUpdate(){const{prevLyricIndex:e}=this.props;this.lyricsRef[e]&&this.lyricsRef[e].current.scrollIntoView()}render(){this.lyricsRef=[];const{lyrics:e,prevLyricIndex:s,toggleIsTouching:r}=this.props;return c.jsx("div",{className:"PlayerLyric",onTouchStart:()=>r(!0),onTouchEnd:()=>r(!1),children:e.map((n,i)=>{const a=j.createRef();return this.lyricsRef.push(a),c.jsx("p",{ref:a,className:_("PlayerLyric_text",{"PlayerLyric_text--active":i===s+1}),children:n.text},i)})})}}function F(t,e=`expected a function, instead received ${typeof t}`){if(typeof t!="function")throw new TypeError(e)}function A(t,e=`expected an object, instead received ${typeof t}`){if(typeof t!="object")throw new TypeError(e)}function H(t,e="expected all items to be functions, instead received the following types: "){if(!t.every(s=>typeof s=="function")){const s=t.map(r=>typeof r=="function"?`function ${r.name||"unnamed"}()`:typeof r).join(", ");throw new TypeError(`${e}[${s}]`)}}var T=t=>Array.isArray(t)?t:[t];function V(t){const e=Array.isArray(t[0])?t[0]:t;return H(e,"createSelector expects all input-selectors to be functions, but received the following types: "),e}function q(t,e){const s=[],{length:r}=t;for(let n=0;n<r;n++)s.push(t[n].apply(null,e));return s}var G=class{constructor(t){this.value=t}deref(){return this.value}},K=typeof WeakRef<"u"?WeakRef:G,J=0,E=1;function x(){return{s:J,v:void 0,o:null,p:null}}function S(t,e={}){let s=x();const{resultEqualityCheck:r}=e;let n,i=0;function a(){let o=s;const{length:p}=arguments;for(let h=0,y=p;h<y;h++){const m=arguments[h];if(typeof m=="function"||typeof m=="object"&&m!==null){let d=o.o;d===null&&(o.o=d=new WeakMap);const f=d.get(m);f===void 0?(o=x(),d.set(m,o)):o=f}else{let d=o.p;d===null&&(o.p=d=new Map);const f=d.get(m);f===void 0?(o=x(),d.set(m,o)):o=f}}const l=o;let u;if(o.s===E)u=o.v;else if(u=t.apply(null,arguments),i++,r){const h=n?.deref?.()??n;h!=null&&r(h,u)&&(u=h,i!==0&&i--),n=typeof u=="object"&&u!==null||typeof u=="function"?new K(u):u}return l.s=E,l.v=u,u}return a.clearCache=()=>{s=x(),a.resetResultsCount()},a.resultsCount=()=>i,a.resetResultsCount=()=>{i=0},a}function Q(t,...e){const s=typeof t=="function"?{memoize:t,memoizeOptions:e}:t,r=(...n)=>{let i=0,a=0,o,p={},l=n.pop();typeof l=="object"&&(p=l,l=n.pop()),F(l,`createSelector expects an output function after the inputs, but received: [${typeof l}]`);const u={...s,...p},{memoize:h,memoizeOptions:y=[],argsMemoize:m=S,argsMemoizeOptions:d=[]}=u,f=T(y),N=T(d),P=V(n),R=h(function(){return i++,l.apply(null,arguments)},...f),I=m(function(){a++;const L=q(P,arguments);return o=R.apply(null,L),o},...N);return Object.assign(I,{resultFunc:l,memoizedResultFunc:R,dependencies:P,dependencyRecomputations:()=>a,resetDependencyRecomputations:()=>{a=0},lastResult:()=>o,recomputations:()=>i,resetRecomputations:()=>{i=0},memoize:h,argsMemoize:m})};return Object.assign(r,{withTypes:()=>r}),r}var C=Q(S),Y=Object.assign((t,e=C)=>{A(t,`createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ${typeof t}`);const s=Object.keys(t),r=s.map(i=>t[i]);return e(r,(...i)=>i.reduce((a,o,p)=>(a[s[p]]=o,a),{}))},{withTypes:()=>Y});const M=C([t=>t],t=>{let e=t.split(/\n/);return e.pop(),e.map(s=>{let r=s.replace("[","").split("]"),n=r[0],i=n.split(":")[0],a=n.split(":")[1].split(".")[0],o=n.split(":")[1].split(".")[1];return{millisecond:i*60*1e3+a*1e3+Number(o),text:r[1].trim().replace(/(男[:：]\s*)|(女[:：]\s*)/,"")}})}),Z=C([t=>t],t=>t.map(e=>e.millisecond));class ee extends g.Component{constructor(e){super(e),this.state={prevLyricIndex:0,isTouching:!1},this.timeUpdateCb=this.timeUpdateCb.bind(this),this.toggleIsTouching=this.toggleIsTouching.bind(this)}toggleIsTouching(e){this.setState({isTouching:e})}componentDidMount(){const{audioElRef:{current:e}}=this.props;e.addEventListener("timeupdate",this.timeUpdateCb)}componentWillUnmount(){const{audioElRef:{current:e}}=this.props;e.removeEventListener("timeupdate",this.timeUpdateCb)}timeUpdateCb(e){const{isTouching:s}=this.state;if(s)return;const{lyric:r}=this.props,n=M(r),i=Z(n);let a=Math.floor(e.target.currentTime*1e3),o=i.findIndex(l=>l>a*1.005),p=o>1?o-2:0;this.setState({prevLyricIndex:p})}render(){const{lyric:e}=this.props,{prevLyricIndex:s}=this.state,n={lyrics:M(e),prevLyricIndex:s,toggleIsTouching:this.toggleIsTouching};return c.jsx(X,{...n})}}const te=({player:{songInfo:{lyric:t},audioElRef:e}})=>({lyric:t,audioElRef:e}),se=v(te,null)(ee);class re extends g.Component{render(){const{audioElRef:{current:e},progressBarRef:s,currentTime:r,currentProgress:n,loadProgress:i,onTouchStart:a}=this.props,o=e===null?{duration:0}:e,p={backgroundImage:`linear-gradient(to right, #2ca2f9 ${n}%, transparent ${n}%),linear-gradient(to right, #6c6b70 ${i}%, transparent ${i}%)`,color:"red"};return c.jsxs("div",{className:"PlayerProgress",onTouchStart:a,children:[c.jsx("div",{className:"PlayerProgress__songCurTime",children:b(r)}),c.jsx("div",{className:"PlayerProgress__progressBar",ref:s,style:p,children:c.jsx("div",{className:"PlayerProgress__progressBarPointer",style:{left:n+"%"}})}),c.jsx("div",{className:"PlayerProgress__songDuration",children:b(o.duration)})]})}}class ne extends g.Component{constructor(e){super(e),this.state={currentTime:0,loadProgress:0,currentProgress:0,isTouching:!1},this.progressBarRef=j.createRef(),this.progressCb=this.progressCb.bind(this),this.timeUpdateCb=this.timeUpdateCb.bind(this),this.setCurTime=this.setCurTime.bind(this),this.setCurTimeOnMove=this.setCurTimeOnMove.bind(this),this.touchEndCb=this.touchEndCb.bind(this)}progressCb(){const{audioElRef:{current:e}}=this.props;if(e.readyState<2)return;let s=e.buffered.length;const r=Math.floor(100*e.buffered.end(s-1)/e.duration);this.setState({loadProgress:r})}timeUpdateCb(e){if(this.state.isTouching)return;const{audioElRef:{current:{duration:s}}}=this.props,r=e.target.currentTime,n=Math.floor(100*r/s);this.setState({currentTime:r,currentProgress:n})}setCurTime(e){this.setState({isTouching:!0}),this.progressBarRect||(this.progressBarRect=this.progressBarRef.current.getBoundingClientRect());let s=e.touches[0].clientX;const r=this.calcCurTime(s,this.progressBarRect.left,0),{audioElRef:{current:{duration:n}}}=this.props,i=Math.floor(100*r/n);this.setState({currentTime:r,currentProgress:i}),this.touchStartX=s,window.addEventListener("touchmove",this.setCurTimeOnMove),window.addEventListener("touchend",this.touchEndCb)}setCurTimeOnMove(e){let s=e.touches[0].clientX;const r=this.calcCurTime(s,this.touchStartX,1),{audioElRef:{current:{duration:n}}}=this.props,i=Math.floor(100*r/n);this.setState({currentTime:r,currentProgress:i}),this.touchStartX=s}touchEndCb(){const{audioElRef:{current:e}}=this.props;this.setState({isTouching:!1}),e.currentTime=this.state.currentTime,window.removeEventListener("touchmove",this.setCurTimeOnMove),window.removeEventListener("touchend",this.touchEndCb)}calcCurTime(e,s,r){let i=(e-s)/this.progressBarRect.width,a;const{audioElRef:{current:{duration:o}}}=this.props;switch(r){case 0:a=o*i;break;case 1:a=this.state.currentTime+o*i;break}return a<0?a=0:a>o&&(a=o),a}componentDidMount(){const{audioElRef:{current:e}}=this.props;e.addEventListener("progress",this.progressCb),e.addEventListener("timeupdate",this.timeUpdateCb)}componentWillUnmount(){const{audioElRef:{current:e}}=this.props;e.removeEventListener("progress",this.progressCb),e.removeEventListener("timeupdate",this.timeUpdateCb)}render(){const{audioElRef:e}=this.props,s={audioElRef:e,...this.state,onTouchStart:this.setCurTime,progressBarRef:this.progressBarRef};return c.jsx(re,{...s})}}const oe=({player:{audioElRef:t}})=>({audioElRef:t}),ie=v(oe,null)(ne);class ae extends g.Component{render(){const{songInfo:{song_name:e,author_name:s,img:r},musicStatus:{isPlaying:n,isLoading:i},dispatch:a,prevSong:o,nextSong:p}=this.props;return c.jsxs(g.Fragment,{children:[c.jsx("div",{className:"PlayerMax__mask",style:{backgroundImage:`url(${r}),linear-gradient(to right, rgb(48, 67, 82), rgb(215, 210, 204))`}}),c.jsxs("div",{className:"PlayerMax__container",children:[c.jsx("h6",{className:"PlayerMax__songName",children:e}),c.jsx("img",{src:r,className:_("PlayerMax__singerImg",{"PlayerMax__singerImg--active":n}),alt:s}),c.jsx(se,{}),c.jsx(ie,{}),c.jsxs("div",{className:"PlayerMax__buttonContainer",children:[c.jsx(O,{className:"PlayerMax__prevBtn",prev:o}),c.jsx(D,{className:"PlayerMax__playBtn",isLoading:i,isPlaying:n,togglePlay:l=>a(B())}),c.jsx(z,{className:"PlayerMax__nextBtn",next:p})]}),c.jsx("button",{className:"PlayerMax__download"})]})]})}}class ce extends g.Component{componentDidMount(){const{dispatch:e,location:s,songInfo:{play_url:r}}=this.props;if(r===""){const n=new URLSearchParams(s.search).get("musicHash");e(k(n,0,[{hash:n}]))}}render(){const{songInfo:{play_url:e},dispatch:s,audioElRef:r}=this.props,n={...this.props};return c.jsx(ae,{...n})}}const le=({player:{musicStatus:t,songInfo:e,audioElRef:s,songIndex:r,songList:n}})=>({musicStatus:t,songInfo:e,audioElRef:s,songIndex:r,songList:n}),ue=null,pe=W(ce);function de(t){const e=$(),s=U();return c.jsx(pe,{...t,location:e,navigate:s})}const fe=v(le,ue)(de);export{fe as default};
