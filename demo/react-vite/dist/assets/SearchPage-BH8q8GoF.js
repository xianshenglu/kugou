import{g as p,h as g,i as k,P as x,S as b,j as a,a as o,f as m,A as E,e as C,b as F,l as H,u as f}from"./index-z8AoRoOO.js";import{i as q}from"./utils-B_dGR-9Z.js";function I(e){return e.data}function U(e){return e.data.info}async function A(){const e=await p.get(g.hotSearch);return U(e.data)}async function M(e){const r=await p.get(`${g.keywordSearch}${e}`);return{list:I(r.data).info,total:r.data.data.total}}const z=({enabled:e=!0}={})=>k({queryKey:["hotSearch"],queryFn:async()=>({list:await A(),status:b}),enabled:e,initialData:{list:[],status:x}}),$=({keyword:e="",enabled:r=!0}={})=>k({queryKey:["keywordSearch",e],queryFn:async()=>({...await M(e),status:b}),enabled:r&&!!e,initialData:{list:[],total:0,status:x}}),G="Search-module__Search__container__x517w",J="Search-module__Search__form__16NmP",Q="Search-module__Search__keyword__I1M4w",T="Search-module__Search__btn__grEzC",B="Search-module__Search__type__gggH4",O="Search-module__Search__item__jjkRl",V="Search-module__Search__count__F8r9w",W="Search-module__Search__resultList__fmd8J",s={Search__container:G,Search__form:J,Search__keyword:Q,Search__btn:T,"Search__btn--active":"Search-module__Search__btn--active__Pc7A7",Search__type:B,Search__item:O,Search__count:V,Search__resultList:W},X=({isKeywordSearchShow:e,isHotSearchShow:r,keyword:i,updateKeyword:u,searchKeyword:n,hotSearch:{list:y},keywordSearch:{list:d,total:h}})=>a.jsxs(o.Fragment,{children:[a.jsx("h4",{className:"main_box_shadow module_title",children:"Search"}),a.jsxs("div",{className:s.Search__container,children:[a.jsxs("form",{className:s.Search__form,onSubmit:t=>t.preventDefault(),children:[a.jsx("input",{type:"text",placeholder:"Singer/Song Name",className:s.Search__keyword,value:i,onChange:t=>u(t.target.value),onKeyUp:t=>q(t)?n():void 0}),a.jsx("button",{className:m(s.Search__btn,{[s["Search__btn--active"]]:e}),type:"button",onClick:n,children:"Search"})]}),a.jsxs("div",{className:m({hidden:!r}),children:[a.jsx("h6",{className:s.Search__type,children:"Recently Popular"}),a.jsx("ul",{children:y.map(t=>a.jsx("li",{className:m(s.Search__item,"main_border_bottom"),onClick:l=>u(t.keyword,n),children:t.keyword},t.keyword))})]}),a.jsxs("div",{className:m({hidden:!e}),children:[a.jsxs("div",{className:s.Search__count,children:["Total ",h," results"]}),a.jsx(E,{data:d,className:s.Search__resultList})]})]})]}),ee=()=>{const e=C(),r=F(),[i]=H(),[u,n]=o.useState(!1),[y,d]=o.useState(!1),[h,t]=o.useState(""),l=o.useRef(null),{data:j,refetch:N}=z({enabled:!1}),{data:v,refetch:P}=$({keyword:i.get("keyword")||"",enabled:!1}),w=f(({search:S})=>{const c=new URLSearchParams(S).get("keyword");c===null||c===""?(N(),d(!0),n(!1),t("")):(P(),d(!1),n(!0),t(c))}),R=f((S,_=()=>{})=>{t(S),l.current=_}),K=f(()=>{const{search:S,pathname:_}=e;if(h===""){r(_);return}const c=new URLSearchParams(S),D=c.get("keyword")!==null;c.set("keyword",h),D?r(_+"?"+c.toString(),{replace:!0}):r(_+"?"+c.toString())});o.useEffect(()=>{w(e)},[e,w]),o.useEffect(()=>{l.current&&(l.current(),l.current=null)},[h]);const L={isKeywordSearchShow:u,isHotSearchShow:y,keyword:h,searchKeyword:K,updateKeyword:R,hotSearch:j,keywordSearch:v};return a.jsx(X,{...L})};export{ee as default};
