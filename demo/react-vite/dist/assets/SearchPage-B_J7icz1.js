import{g as p,h as k,P as x,S as g,j as a,d as o,f as m,A as E,e as C,a as F,k as H,u as f}from"./index-Tgyk5spB.js";import{u as j}from"./useQuery-BgpO1x0I.js";import{i as q}from"./utils-B_dGR-9Z.js";function I(e){return e.data}function U(e){return e.data.info}async function A(){const e=await p.get(k.hotSearch);return U(e.data)}async function M(e){const r=await p.get(`${k.keywordSearch}${e}`);return{list:I(r.data).info,total:r.data.data.total}}const z=({enabled:e=!0}={})=>j({queryKey:["hotSearch"],queryFn:async()=>({list:await A(),status:g}),enabled:e,initialData:{list:[],status:x}}),$=({keyword:e="",enabled:r=!0}={})=>j({queryKey:["keywordSearch",e],queryFn:async()=>({...await M(e),status:g}),enabled:r&&!!e,initialData:{list:[],total:0,status:x}}),G="Search-module__Search__container__x517w",J="Search-module__Search__form__16NmP",Q="Search-module__Search__keyword__I1M4w",B="Search-module__Search__btn__grEzC",O="Search-module__Search__type__gggH4",T="Search-module__Search__item__jjkRl",V="Search-module__Search__count__F8r9w",W="Search-module__Search__resultList__fmd8J",s={Search__container:G,Search__form:J,Search__keyword:Q,Search__btn:B,"Search__btn--active":"Search-module__Search__btn--active__Pc7A7",Search__type:O,Search__item:T,Search__count:V,Search__resultList:W},X=({isKeywordSearchShow:e,isHotSearchShow:r,keyword:i,updateKeyword:S,searchKeyword:n,hotSearch:{list:y},keywordSearch:{list:d,total:_}})=>a.jsxs(o.Fragment,{children:[a.jsx("h4",{className:"main_box_shadow module_title",children:"搜索"}),a.jsxs("div",{className:s.Search__container,children:[a.jsxs("form",{className:s.Search__form,onSubmit:t=>t.preventDefault(),children:[a.jsx("input",{type:"text",placeholder:"歌手/歌名/拼音",className:s.Search__keyword,value:i,onChange:t=>S(t.target.value),onKeyUp:t=>q(t)?n():void 0}),a.jsx("button",{className:m(s.Search__btn,{[s["Search__btn--active"]]:e}),type:"button",onClick:n,children:"搜索"})]}),a.jsxs("div",{className:m({hidden:!r}),children:[a.jsx("h6",{className:s.Search__type,children:"最近热门"}),a.jsx("ul",{children:y.map(t=>a.jsx("li",{className:m(s.Search__item,"main_border_bottom"),onClick:l=>S(t.keyword,n),children:t.keyword},t.keyword))})]}),a.jsxs("div",{className:m({hidden:!e}),children:[a.jsxs("div",{className:s.Search__count,children:["共有",_,"条结果"]}),a.jsx(E,{data:d,className:s.Search__resultList})]})]})]}),ae=()=>{const e=C(),r=F(),[i]=H(),[S,n]=o.useState(!1),[y,d]=o.useState(!1),[_,t]=o.useState(""),l=o.useRef(null),{data:b,refetch:N}=z({enabled:!1}),{data:v,refetch:P}=$({keyword:i.get("keyword")||"",enabled:!1}),w=f(({search:u})=>{const c=new URLSearchParams(u).get("keyword");c===null||c===""?(N(),d(!0),n(!1),t("")):(P(),d(!1),n(!0),t(c))}),K=f((u,h=()=>{})=>{t(u),l.current=h}),L=f(()=>{const{search:u,pathname:h}=e;if(_===""){r(h);return}const c=new URLSearchParams(u),D=c.get("keyword")!==null;c.set("keyword",_),D?r(h+"?"+c.toString(),{replace:!0}):r(h+"?"+c.toString())});o.useEffect(()=>{w(e)},[e,w]),o.useEffect(()=>{l.current&&(l.current(),l.current=null)},[_]);const R={isKeywordSearchShow:S,isHotSearchShow:y,keyword:_,searchKeyword:L,updateKeyword:K,hotSearch:b,keywordSearch:v};return a.jsx(X,{...R})};export{ae as default};
