import{g as u,j as s,o as R,O as k,h as j,c as x,u as D,a as H}from"./index-BLtaIns3.js";import{P as O,a as Y,N as z,u as F}from"./useNextPrevSong-CICErKmP.js";import{u as S}from"./index-1UowtNvo.js";const U="PlayerMax-module__PlayerMax__mask__YPHjh",V="PlayerMax-module__PlayerMax__container__cn2nZ",W="PlayerMax-module__PlayerMax__songName__bOYDz",q="PlayerMax-module__PlayerMax__singerImg__eV9IC",J="PlayerMax-module__PlayerMax__buttonContainer__DsOIS",Z="PlayerMax-module__PlayerMax__prevBtn__30-Yo",Q="PlayerMax-module__PlayerMax__nextBtn__qIfxs",A="PlayerMax-module__PlayerMax__playBtn__mZv5b",G="PlayerMax-module__PlayerMax__download__EyIPb",m={PlayerMax__mask:U,PlayerMax__container:V,PlayerMax__songName:W,PlayerMax__singerImg:q,"PlayerMax__singerImg--active":"PlayerMax-module__PlayerMax__singerImg--active__0br27",PlayerMax__buttonContainer:J,PlayerMax__prevBtn:Z,PlayerMax__nextBtn:Q,PlayerMax__playBtn:A,PlayerMax__download:G},K="PlayerLyric-module__PlayerLyric__QMiTC",ee="PlayerLyric-module__PlayerLyric_text__JjHWv",w={PlayerLyric:K,PlayerLyric_text:ee,"PlayerLyric_text--active":"PlayerLyric-module__PlayerLyric_text--active__jeHXO"},re=({lyrics:e,prevLyricIndex:t,toggleIsTouching:n})=>{const r=u.useRef([]),c=(o,a)=>(r.current[o]=a,()=>{r.current.splice(o,1)});return u.useEffect(()=>{r.current[t]?.scrollIntoView()},[t]),s.jsx("div",{className:w.PlayerLyric,onTouchStart:()=>n(!0),onTouchEnd:()=>n(!1),children:e.map((o,a)=>s.jsx("p",{ref:l=>c(a,l),className:R(w.PlayerLyric_text,{[w["PlayerLyric_text--active"]]:a===t+1}),children:o.text},a))})},T=k([e=>e],e=>{const t=e.split(/\n/);return t.pop(),t.map(n=>{const r=n.replace("[","").split("]"),c=r[0],o=c.split(":")[0],a=c.split(":")[1].split(".")[0],l=c.split(":")[1].split(".")[1];return{millisecond:Number(o)*60*1e3+Number(a)*1e3+Number(l),text:r[1].trim().replace(/(男[:：]\s*)|(女[:：]\s*)/,"")}})}),te=()=>{const[e,t]=u.useState(0),[n,r]=u.useState(!1),{songInfo:{lyric:c},audioElRef:o}=j(),a=x(i=>{r(i)}),l=x(i=>{if(n)return;const d=T(c).map(v=>v.millisecond),B=Math.floor(i.target.currentTime*1e3),b=d.findIndex(v=>v>B*1.005),C=b>1?b-2:0;t(C)});u.useEffect(()=>{const i=o.current;if(i)return i.addEventListener("timeupdate",l),()=>{i.removeEventListener("timeupdate",l)}},[o]);const p={lyrics:T(c),prevLyricIndex:e,toggleIsTouching:a};return s.jsx(re,{...p})},se="PlayerProgress-module__PlayerProgress__mzM-h",ae="PlayerProgress-module__PlayerProgress__songCurTime__mDV-2",ne="PlayerProgress-module__PlayerProgress__songDuration__-WXmx",oe="PlayerProgress-module__PlayerProgress__progressBar__YqIcJ",ce="PlayerProgress-module__PlayerProgress__progressBarPointer__W8S6Y",L={PlayerProgress:se,PlayerProgress__songCurTime:ae,PlayerProgress__songDuration:ne,PlayerProgress__progressBar:oe,PlayerProgress__progressBarPointer:ce};function I(e){if(isNaN(Number(e)))return"00:00";const t=Math.floor(Number(e)),n=t%60,r=Math.floor(t/60);return String(r).padStart(2,"0")+":"+String(n).padStart(2,"0")}const le=({audioElRef:{current:e},progressBarRef:t,currentTime:n,currentProgress:r,loadProgress:c,onTouchStart:o})=>{const a=e===null?{duration:0}:e,l={backgroundImage:`linear-gradient(to right, #2ca2f9 ${r}%, transparent ${r}%),linear-gradient(to right, #6c6b70 ${c}%, transparent ${c}%)`,color:"red"};return s.jsxs("div",{className:L.PlayerProgress,onTouchStart:o,children:[s.jsx("div",{className:L.PlayerProgress__songCurTime,children:I(n)}),s.jsx("div",{className:L.PlayerProgress__progressBar,ref:t,style:l,children:s.jsx("div",{className:L.PlayerProgress__progressBarPointer,style:{left:r+"%"}})}),s.jsx("div",{className:L.PlayerProgress__songDuration,children:I(a.duration)})]})},ie=()=>{const{audioElRef:e}=j(),[t,n]=u.useState(0),[r,c]=u.useState(0),[o,a]=u.useState(0),[l,N]=u.useState(!1),p=u.useRef(null),i=u.useRef(null),h=u.useRef(0),d=x((_,P,y)=>{const g=(_-P)/i.current.width;let M;const E=e.current;switch(y){case 0:M=E.duration*g;break;case 1:M=t+E.duration*g;break}return M<0?M=0:M>E.duration&&(M=E.duration),M}),B=x(()=>{const _=e.current;if(_.readyState<2)return;const P=_.buffered.length,y=Math.floor(100*_.buffered.end(P-1)/_.duration);c(y)}),b=x(_=>{if(l)return;const P=e.current,f=_.target.currentTime,g=Math.floor(100*f/P.duration);n(f),a(g)}),C=x(_=>{const P=_.touches[0].clientX,y=d(P,h.current,1),f=e.current,g=Math.floor(100*y/f.duration);n(y),a(g),h.current=P}),v=x(()=>{const _=e.current;N(!1),Number.isNaN(t)||(_.currentTime=t),window.removeEventListener("touchmove",C),window.removeEventListener("touchend",v)}),X=x(_=>{N(!0),i.current||(i.current=p.current.getBoundingClientRect());const P=_.touches[0].clientX,y=d(P,i.current.left,0),f=e.current,g=Math.floor(100*y/f.duration);n(y),a(g),h.current=P,window.addEventListener("touchmove",C),window.addEventListener("touchend",v)});S("progress",B,{target:()=>e.current}),S("timeupdate",b,{target:()=>e.current});const $={audioElRef:e,currentTime:t,loadProgress:r,currentProgress:o,isTouching:l,onTouchStart:X,progressBarRef:p};return s.jsx(le,{...$})},_e=({songInfo:{song_name:e,author_name:t,img:n},musicStatus:{isPlaying:r,isLoading:c},prevSong:o,nextSong:a})=>{const{togglePlay:l}=j();return s.jsxs(u.Fragment,{children:[s.jsx("div",{className:m.PlayerMax__mask,style:{backgroundImage:`url(${n}),linear-gradient(to right, rgb(48, 67, 82), rgb(215, 210, 204))`}}),s.jsxs("div",{className:m.PlayerMax__container,children:[s.jsx("h6",{className:m.PlayerMax__songName,children:e}),s.jsx("img",{src:n,className:R(m.PlayerMax__singerImg,{[m["PlayerMax__singerImg--active"]]:r}),alt:t}),s.jsx(te,{}),s.jsx(ie,{}),s.jsxs("div",{className:m.PlayerMax__buttonContainer,children:[s.jsx(O,{className:m.PlayerMax__prevBtn,prev:o}),s.jsx(Y,{className:m.PlayerMax__playBtn,isLoading:c,isPlaying:r,togglePlay:l}),s.jsx(z,{className:m.PlayerMax__nextBtn,next:a})]}),s.jsx("button",{className:m.PlayerMax__download})]})]})},me=()=>{const e=D(),t=H(),{musicStatus:n,songInfo:r,audioElRef:c,songIndex:o,songList:a,fetchMusicIfNeeded:l}=j();u.useEffect(()=>{const{play_url:h}=r;if(h===""){const d=new URLSearchParams(e.search).get("musicHash");d&&l(d,0,[{hash:d}])}},[e.search,r,l]);const N={musicStatus:n,songInfo:r,audioElRef:c,songIndex:o,songList:a,location:e,navigate:t},{nextSong:p,prevSong:i}=F(a,o);return s.jsx(_e,{...N,nextSong:p,prevSong:i})};export{me as default};
