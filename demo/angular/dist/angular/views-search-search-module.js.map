{"version":3,"sources":["./src/app/views/search/search-routing.module.ts","./src/app/views/search/search.module.ts","./src/app/services/search.service.ts","./src/app/views/search/search.component.html","./src/app/views/search/search.component.ts"],"names":[],"mappings":"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","file":"views-search-search-module.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { RouterModule, Routes } from '@angular/router';\r\nimport { SearchComponent } from './search.component';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: 'index',\r\n    component: SearchComponent,\r\n  },\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class SearchRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { SearchComponent } from './search.component';\r\nimport { SearchRoutingModule } from './search-routing.module';\r\nimport { SharedModule } from '../../shared/shared.module';\r\n\r\n@NgModule({\r\n  declarations: [SearchComponent],\r\n  imports: [CommonModule, FormsModule, SharedModule, SearchRoutingModule],\r\n})\r\nexport class SearchModule {}\r\n","import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { KU_GOU_MOBILE_CDN_ORIGIN } from '../constants/index';\r\n\r\ntype SearchResponse = {\r\n  data: { info: { keyword: string }[] };\r\n};\r\n@Injectable({\r\n  providedIn: 'root',\r\n})\r\nexport class SearchService {\r\n  constructor(private http: HttpClient) {}\r\n\r\n  async fetchSearchResult(keyword: string) {\r\n    const response = await this.http\r\n      .get<SearchResponse>(\r\n        `${KU_GOU_MOBILE_CDN_ORIGIN}/api/v3/search/song/&format=json&page=1&pagesize=20&showtype=1&keyword=${keyword}`\r\n      )\r\n      .toPromise();\r\n    return response.data;\r\n  }\r\n\r\n  async fetchHotSearch() {\r\n    const response = await this.http\r\n      .get<SearchResponse>(\r\n        `${KU_GOU_MOBILE_CDN_ORIGIN}/api/v3/search/hot&format=json&plat=0&count=30`\r\n      )\r\n      .toPromise();\r\n    return response.data.info;\r\n  }\r\n}\r\n","<section class=\"search\">\r\n  <app-my-module-title\r\n    [title]=\"title\"\r\n    class=\"search__title\"\r\n    (titleClick)=\"scrollTopSearchCont()\"\r\n  >\r\n  </app-my-module-title>\r\n  <div class=\"search__cont\" #searchCont>\r\n    <form class=\"search__form\" (submit)=\"$event.preventDefault()\">\r\n      <input\r\n        type=\"text\"\r\n        [attr.placeholder]=\"placeholder\"\r\n        class=\"search__input\"\r\n        [(ngModel)]=\"keyword\"\r\n        name=\"keyword\"\r\n        (keyup.enter)=\"getSearchRes()\"\r\n      />\r\n      <button\r\n        [class]=\"\r\n          isSearchResShow ? 'search__btn search__btn--active' : 'search__btn'\r\n        \"\r\n        type=\"button\"\r\n        (click)=\"getSearchRes()\"\r\n      >\r\n        {{ title }}\r\n      </button>\r\n    </form>\r\n    <div class=\"search__rec\" *ngIf=\"isSearchRecShow\">\r\n      <h6 class=\"search__type\">{{ searchType }}</h6>\r\n      <ul class=\"search__list\">\r\n        <li\r\n          class=\"search__item main_border_bottom\"\r\n          *ngFor=\"let item of searchRecArr\"\r\n          (click)=\"keyword = item.keyword; getSearchRes()\"\r\n        >\r\n          {{ item.keyword }}\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <div class=\"search__res\" ng-show=\"isSearchResShow\">\r\n      <div class=\"search__count\">共有{{ searchResInfo.length }}条结果</div>\r\n      <app-my-music-list [musicList]=\"searchResInfo\" class=\"search__res-list\">\r\n      </app-my-music-list>\r\n    </div>\r\n  </div>\r\n</section>\r\n","import { ResponseTypeFromServiceReq } from 'src/app/typings/index';\r\nimport { SearchService } from 'src/app/services/search.service';\r\nimport { ActivatedRoute, Router } from '@angular/router';\r\nimport { EventBusService } from 'src/app/services/event-bus.service';\r\nimport { Component, OnInit, ViewChild, ElementRef } from '@angular/core';\r\n\r\n@Component({\r\n  selector: 'app-search',\r\n  templateUrl: './search.component.html',\r\n  styleUrls: ['./search.component.scss'],\r\n})\r\nexport class SearchComponent implements OnInit {\r\n  // @ts-ignore\r\n  @ViewChild('searchCont') searchCont: ElementRef;\r\n\r\n  title = '搜索';\r\n\r\n  searchType = '最近热门';\r\n\r\n  placeholder = '歌手/歌名/拼音';\r\n\r\n  searchRecArr: ResponseTypeFromServiceReq<\r\n    typeof SearchService,\r\n    'fetchHotSearch'\r\n  > = [];\r\n\r\n  searchRes: ResponseTypeFromServiceReq<\r\n    typeof SearchService,\r\n    'fetchSearchResult'\r\n  > = { info: [] };\r\n\r\n  keyword = '';\r\n\r\n  isSearchRecShow = false;\r\n\r\n  isSearchResShow = false;\r\n\r\n  get searchResInfo() {\r\n    // @ts-ignore\r\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\r\n    return this.searchRes.info;\r\n  }\r\n\r\n  constructor(\r\n    private eventBus: EventBusService,\r\n    private router: Router,\r\n    private activatedRoute: ActivatedRoute,\r\n    private searchService: SearchService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.searchByUrl();\r\n  }\r\n\r\n  searchByUrl() {\r\n    // remove in destroy?\r\n    // eslint-disable-next-line @typescript-eslint/unbound-method\r\n    this.eventBus.on('searchBtnClicked', this.scrollTopSearchCont);\r\n    const queryKeyword = new URLSearchParams(window.location.search).get(\r\n      'keyword'\r\n    );\r\n    const isKeywordValid =\r\n      typeof this.keyword === 'string' && this.keyword !== '';\r\n    const isQueryKeywordValid =\r\n      typeof queryKeyword === 'string' && queryKeyword !== '';\r\n    if (isQueryKeywordValid && queryKeyword !== this.keyword) {\r\n      // @ts-ignore\r\n      this.keyword = queryKeyword;\r\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n      this.getSearchRes();\r\n    } else if (isKeywordValid) {\r\n      this.isSearchRecShow = false;\r\n      this.isSearchResShow = true;\r\n    } else {\r\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n      this.getSearchRec();\r\n    }\r\n  }\r\n\r\n  async getSearchRec() {\r\n    if (this.searchRecArr.length !== 0) {\r\n      this.isSearchResShow = false;\r\n      this.isSearchRecShow = true;\r\n      return;\r\n    }\r\n    this.searchRecArr = await this.searchService.fetchHotSearch();\r\n\r\n    this.isSearchResShow = false;\r\n    this.isSearchRecShow = true;\r\n  }\r\n\r\n  async getSearchRes() {\r\n    if (this.keyword === '') {\r\n      return;\r\n    }\r\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n    this.router.navigate([], {\r\n      relativeTo: this.activatedRoute,\r\n      queryParams: { keyword: this.keyword },\r\n      queryParamsHandling: 'merge',\r\n    });\r\n\r\n    this.searchRes = await this.searchService.fetchSearchResult(this.keyword);\r\n\r\n    this.isSearchRecShow = false;\r\n    this.isSearchResShow = true;\r\n  }\r\n\r\n  scrollTopSearchCont() {\r\n    if (this.searchCont.nativeElement) {\r\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\r\n      this.searchCont.nativeElement.scrollTop = 0;\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":"webpack:///"}