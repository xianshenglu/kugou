{"version":3,"sources":["./src/app/views/search/search-routing.module.ts","./src/app/views/search/search.module.ts","./src/app/services/search.service.ts","./src/app/views/search/search.component.html","./src/app/views/search/search.component.ts"],"names":[],"mappings":"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","file":"views-search-search-module.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { SearchComponent } from './search.component';\n\nconst routes: Routes = [\n  {\n    path: 'index',\n    component: SearchComponent,\n  },\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class SearchRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { SearchComponent } from './search.component';\nimport { SearchRoutingModule } from './search-routing.module';\nimport { SharedModule } from '../../shared/shared.module';\n\n@NgModule({\n  declarations: [SearchComponent],\n  imports: [CommonModule, FormsModule, SharedModule, SearchRoutingModule],\n})\nexport class SearchModule {}\n","import { HttpClient } from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { KU_GOU_MOBILE_CDN_ORIGIN } from '../constants/index';\n\ntype SearchResponse = {\n  data: { info: { keyword: string }[] };\n};\n@Injectable({\n  providedIn: 'root',\n})\nexport class SearchService {\n  constructor(private http: HttpClient) {}\n\n  async fetchSearchResult(keyword: string) {\n    const response = await this.http\n      .get<SearchResponse>(\n        `${KU_GOU_MOBILE_CDN_ORIGIN}/api/v3/search/song/&format=json&page=1&pagesize=20&showtype=1&keyword=${keyword}`\n      )\n      .toPromise();\n    return response.data;\n  }\n\n  async fetchHotSearch() {\n    const response = await this.http\n      .get<SearchResponse>(\n        `${KU_GOU_MOBILE_CDN_ORIGIN}/api/v3/search/hot&format=json&plat=0&count=30`\n      )\n      .toPromise();\n    return response.data.info;\n  }\n}\n","<section class=\"search\">\n  <app-my-module-title\n    [title]=\"title\"\n    class=\"search__title\"\n    (titleClick)=\"scrollTopSearchCont()\"\n  >\n  </app-my-module-title>\n  <div class=\"search__cont\" #searchCont>\n    <form class=\"search__form\" (submit)=\"$event.preventDefault()\">\n      <input\n        type=\"text\"\n        [attr.placeholder]=\"placeholder\"\n        class=\"search__input\"\n        [(ngModel)]=\"keyword\"\n        name=\"keyword\"\n        (keyup.enter)=\"getSearchRes()\"\n      />\n      <button\n        [class]=\"\n          isSearchResShow ? 'search__btn search__btn--active' : 'search__btn'\n        \"\n        type=\"button\"\n        (click)=\"getSearchRes()\"\n      >\n        {{ title }}\n      </button>\n    </form>\n    <div class=\"search__rec\" *ngIf=\"isSearchRecShow\">\n      <h6 class=\"search__type\">{{ searchType }}</h6>\n      <ul class=\"search__list\">\n        <li\n          class=\"search__item main_border_bottom\"\n          *ngFor=\"let item of searchRecArr\"\n          (click)=\"keyword = item.keyword; getSearchRes()\"\n        >\n          {{ item.keyword }}\n        </li>\n      </ul>\n    </div>\n    <div class=\"search__res\" ng-show=\"isSearchResShow\">\n      <div class=\"search__count\">共有{{ searchResInfo.length }}条结果</div>\n      <app-my-music-list [musicList]=\"searchResInfo\" class=\"search__res-list\">\n      </app-my-music-list>\n    </div>\n  </div>\n</section>\n","import { ResponseTypeFromServiceReq } from 'src/app/typings/index';\nimport { SearchService } from 'src/app/services/search.service';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { EventBusService } from 'src/app/services/event-bus.service';\nimport { Component, OnInit, ViewChild, ElementRef } from '@angular/core';\n\n@Component({\n  selector: 'app-search',\n  templateUrl: './search.component.html',\n  styleUrls: ['./search.component.scss'],\n})\nexport class SearchComponent implements OnInit {\n  // @ts-ignore\n  @ViewChild('searchCont') searchCont: ElementRef;\n\n  title = '搜索';\n\n  searchType = '最近热门';\n\n  placeholder = '歌手/歌名/拼音';\n\n  searchRecArr: ResponseTypeFromServiceReq<\n    typeof SearchService,\n    'fetchHotSearch'\n  > = [];\n\n  searchRes: ResponseTypeFromServiceReq<\n    typeof SearchService,\n    'fetchSearchResult'\n  > = { info: [] };\n\n  keyword = '';\n\n  isSearchRecShow = false;\n\n  isSearchResShow = false;\n\n  get searchResInfo() {\n    // @ts-ignore\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-return\n    return this.searchRes.info;\n  }\n\n  constructor(\n    private eventBus: EventBusService,\n    private router: Router,\n    private activatedRoute: ActivatedRoute,\n    private searchService: SearchService\n  ) {}\n\n  ngOnInit(): void {\n    this.searchByUrl();\n  }\n\n  searchByUrl() {\n    // remove in destroy?\n    // eslint-disable-next-line @typescript-eslint/unbound-method\n    this.eventBus.on('searchBtnClicked', this.scrollTopSearchCont);\n    const queryKeyword = new URLSearchParams(window.location.search).get(\n      'keyword'\n    );\n    const isKeywordValid =\n      typeof this.keyword === 'string' && this.keyword !== '';\n    const isQueryKeywordValid =\n      typeof queryKeyword === 'string' && queryKeyword !== '';\n    if (isQueryKeywordValid && queryKeyword !== this.keyword) {\n      // @ts-ignore\n      this.keyword = queryKeyword;\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.getSearchRes();\n    } else if (isKeywordValid) {\n      this.isSearchRecShow = false;\n      this.isSearchResShow = true;\n    } else {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      this.getSearchRec();\n    }\n  }\n\n  async getSearchRec() {\n    if (this.searchRecArr.length !== 0) {\n      this.isSearchResShow = false;\n      this.isSearchRecShow = true;\n      return;\n    }\n    this.searchRecArr = await this.searchService.fetchHotSearch();\n\n    this.isSearchResShow = false;\n    this.isSearchRecShow = true;\n  }\n\n  async getSearchRes() {\n    if (this.keyword === '') {\n      return;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    this.router.navigate([], {\n      relativeTo: this.activatedRoute,\n      queryParams: { keyword: this.keyword },\n      queryParamsHandling: 'merge',\n    });\n\n    this.searchRes = await this.searchService.fetchSearchResult(this.keyword);\n\n    this.isSearchRecShow = false;\n    this.isSearchResShow = true;\n  }\n\n  scrollTopSearchCont() {\n    if (this.searchCont.nativeElement) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      this.searchCont.nativeElement.scrollTop = 0;\n    }\n  }\n}\n"],"sourceRoot":"webpack:///"}